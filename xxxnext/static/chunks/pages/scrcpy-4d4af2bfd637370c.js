(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{8014:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scrcpy",function(){return i(7090)}])},4679:function(e,t,i){"use strict";i.d(t,{X:function(){return o}});var r=i(7074),n=i(8451);function o(){let[e,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return;let t=e.parentElement,i=t.style.flexGrow;return t.style.flexGrow="1",()=>{t.style.flexGrow=i}},[e]),(0,r.jsx)("div",{ref:t})}},7090:function(e,t,i){"use strict";let r,n,o;i.r(t),i.d(t,{default:function(){return iB}});var a,s,l,d,c,u,h,p,m,f,g,y,v,b,w,S,x,L,E,k,C,T,A,P,D,N,M,_,O,z,R,F,U,I,H,j,B,G,V,K,W=i(7074),Z=i(6484),Y=i(5963),q=i(6749),X=i(5236),J=i(4919),$=i(4305),Q=i(3817),ee=i(6883),et=i(1478),ei=i(3556);function*er(e){let t=-1,i=0,r=!1;for(let n=0;n<e.length;n+=1){let o=e[n];if(r){if(o>3)throw Error("Invalid data");r=!1;continue}if(0===o){i+=1;continue}let a=i;if(i=0,-1===t){if(a>=2&&1===o){t=n+1;continue}throw Error("Invalid data")}if(!(a<2)){if(1===o){yield e.subarray(t,n-a),t=n+1;continue}if(a>2)throw Error("Invalid data");switch(o){case 2:throw Error("Invalid data");case 3:r=!0}}}if(r)throw Error("Invalid data");yield e.subarray(t,e.length)}(a=C||(C={}))[a.Main8=1]="Main8",a[a.Main10=2]="Main10",a[a.Main10Hdr10=4096]="Main10Hdr10",a[a.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(s=T||(T={}))[s.Level2=1]="Level2",s[s.Level21=2]="Level21",s[s.Level22=4]="Level22",s[s.Level23=8]="Level23",s[s.Level3=16]="Level3",s[s.Level31=32]="Level31",s[s.Level32=64]="Level32",s[s.Level33=128]="Level33",s[s.Level4=256]="Level4",s[s.Level41=512]="Level41",s[s.Level42=1024]="Level42",s[s.Level43=2048]="Level43",s[s.Level5=4096]="Level5",s[s.Level51=8192]="Level51",s[s.Level52=16384]="Level52",s[s.Level53=32768]="Level53",s[s.Level6=65536]="Level6",s[s.Level61=131072]="Level61",s[s.Level62=262144]="Level62",s[s.Level63=524288]="Level63",s[s.Level7=1048576]="Level7",s[s.Level71=2097152]="Level71",s[s.Level72=4194304]="Level72",s[s.Level73=8388608]="Level73";class en{#e;#t;#i;#r=0;#n=-1;#o=-1;#a=0;get byteLength(){return this.#t}get stopBitIndex(){return this.#i}get bytePosition(){return this.#n}get bitPosition(){return this.#o}get ended(){return this.#n===this.#t&&this.#o===this.#i}constructor(e){this.#e=e;for(let t=e.length-1;t>=0;t-=1){if(0===this.#e[t])continue;let i=e[t];for(let e=0;e<8;e+=1)if((i>>e&1)==1){this.#t=t,this.#i=e,this.#s();return}}throw Error("Stop bit not found")}#s(){if(this.#a=this.#e[this.#n],2===this.#r&&3===this.#a){this.#r=0,this.#n+=1,this.#s();return}0===this.#a?this.#r+=1:this.#r=0}next(){if(-1===this.#o&&(this.#o=7,this.#n+=1,this.#s()),this.ended)throw Error("Bit index out of bounds");let e=this.#a>>this.#o&1;return this.#o-=1,e}read(e){if(e>32)throw Error("Read length too large");let t=0;for(let i=0;i<e;i+=1)t=t<<1|this.next();return t}skip(e){for(let t=0;t<e;t+=1)this.next()}decodeExponentialGolombNumber(){let e=0;for(;0===this.next();)e+=1;return 0===e?0:(1<<e|this.read(e))-1}#l(){return{zeroCount:this.#r,bytePosition:this.#n,bitPosition:this.#o,byte:this.#a}}#d(e){this.#r=e.zeroCount,this.#n=e.bytePosition,this.#o=e.bitPosition,this.#a=e.byte}peek(e){let t=this.#l(),i=this.read(e);return this.#d(t),i}readBytes(e){let t=new Uint8Array(e);for(let i=0;i<e;i+=1)t[i]=this.read(8);return t}peekBytes(e){let t=this.#l(),i=this.readBytes(e);return this.#d(t),i}}function eo(e){let t,i;for(let r of er(e)){let e=31&r[0];switch(e){case 7:if(t=r,i)return{sequenceParameterSet:t,pictureParameterSet:i};break;case 8:if(i=r,t)return{sequenceParameterSet:t,pictureParameterSet:i}}}throw Error("Invalid data")}function ea(e){let{sequenceParameterSet:t,pictureParameterSet:i}=eo(e),{profile_idc:r,constraint_set:n,level_idc:o,pic_width_in_mbs_minus1:a,pic_height_in_map_units_minus1:s,frame_mbs_only_flag:l,frame_crop_left_offset:d,frame_crop_right_offset:c,frame_crop_top_offset:u,frame_crop_bottom_offset:h}=function(e){let t,i,r,n;let o=new en(e);if(0!==o.next())throw Error("Invalid data");let a=o.read(2),s=o.read(5);if(7!==s||0===a)throw Error("Invalid data");let l=o.read(8),d=o.peek(8),c=!!o.next(),u=!!o.next(),h=!!o.next(),p=!!o.next(),m=!!o.next(),f=!!o.next();if(0!==o.read(2))throw Error("Invalid data");let g=o.read(8),y=o.decodeExponentialGolombNumber();if(100===l||110===l||122===l||244===l||44===l||83===l||86===l||118===l||128===l||138===l||139===l||134===l){let e=o.decodeExponentialGolombNumber();3===e&&o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber(),o.next();let t=!!o.next();if(t){let t=[];for(let i=0;i<(3!==e?8:12);i+=1)t[i]=!!o.next(),t[i]}}o.decodeExponentialGolombNumber();let v=o.decodeExponentialGolombNumber();if(0===v)o.decodeExponentialGolombNumber();else if(1===v){o.next(),o.decodeExponentialGolombNumber(),o.decodeExponentialGolombNumber();let e=o.decodeExponentialGolombNumber(),t=[];for(let i=0;i<e;i+=1)t[i]=o.decodeExponentialGolombNumber()}o.decodeExponentialGolombNumber(),o.next();let b=o.decodeExponentialGolombNumber(),w=o.decodeExponentialGolombNumber(),S=o.next();S||o.next(),o.next();let x=!!o.next();return x?(t=o.decodeExponentialGolombNumber(),i=o.decodeExponentialGolombNumber(),r=o.decodeExponentialGolombNumber(),n=o.decodeExponentialGolombNumber()):(t=0,i=0,r=0,n=0),o.next(),{profile_idc:l,constraint_set:d,constraint_set0_flag:c,constraint_set1_flag:u,constraint_set2_flag:h,constraint_set3_flag:p,constraint_set4_flag:m,constraint_set5_flag:f,level_idc:g,seq_parameter_set_id:y,pic_width_in_mbs_minus1:b,pic_height_in_map_units_minus1:w,frame_mbs_only_flag:S,frame_cropping_flag:x,frame_crop_left_offset:t,frame_crop_right_offset:i,frame_crop_top_offset:r,frame_crop_bottom_offset:n}}(t),p=(a+1)*16,m=(s+1)*(2-l)*16,f=2*d,g=2*c,y=2*u,v=2*h;return{pictureParameterSet:i,sequenceParameterSet:t,profileIndex:r,constraintSet:n,levelIndex:o,encodedWidth:p,encodedHeight:m,cropLeft:f,cropRight:g,cropTop:y,cropBottom:v,croppedWidth:p-f-g,croppedHeight:m-y-v}}function es(e){let t,i,r,n,o,a,s,l;let d=new en(e),c=d.read(4),u=!!d.next(),h=!!d.next(),p=d.read(6),m=d.read(3),f=!!d.next();d.skip(16);let g=ec(d,!0,m),y=!!d.next(),v=[],b=[],w=[];for(let e=y?0:m;e<=m;e+=1)v[e]=d.decodeExponentialGolombNumber(),b[e]=d.decodeExponentialGolombNumber(),w[e]=d.decodeExponentialGolombNumber();let S=d.read(6),x=d.decodeExponentialGolombNumber(),L=[];for(let e=1;e<=x;e+=1){L[e]=[];for(let t=0;t<=S;t+=1)L[e][t]=!!d.next()}let E=!!d.next();if(E){t=d.read(32),i=d.read(32),(r=!!d.next())&&(n=d.decodeExponentialGolombNumber()),o=d.decodeExponentialGolombNumber(),a=[],s=[!0],l=[];for(let e=0;e<o;e+=1)a[e]=d.decodeExponentialGolombNumber(),e>0&&(s[e]=!!d.next()),l[e]=function(e,t,i){let r,n,o,a,s,l,d,c,u,h,p,m,f;t&&(r=!!e.next(),n=!!e.next(),(r||n)&&((o=!!e.next())&&(a=e.read(8),s=e.read(5),l=!!e.next(),d=e.read(5)),c=e.read(4),u=e.read(4),o&&(h=e.read(4)),p=e.read(5),m=e.read(5),f=e.read(5)));let g=[],y=[],v=[],b=[],w=[],S=[],x=[];for(let t=0;t<=i;t+=1){var L,E;g[t]=!!e.next(),g[t]||(y[t]=!!e.next()),y[t]?v[t]=e.decodeExponentialGolombNumber():b[t]=!!e.next(),b[t]||(w[t]=e.decodeExponentialGolombNumber()),r&&(S[t]=eu(e,t,(L=w[t])+1)),n&&(x[t]=eu(e,t,(E=w[t])+1))}return{nal_hrd_parameters_present_flag:r,vcl_hrd_parameters_present_flag:n,sub_pic_hrd_params_present_flag:o,tick_divisor_minus2:a,du_cpb_removal_delay_increment_length_minus1:s,sub_pic_cpb_params_in_pic_timing_sei_flag:l,dpb_output_delay_du_length_minus1:d,bit_rate_scale:c,cpb_size_scale:u,cpb_size_du_scale:h,initial_cpb_removal_delay_length_minus1:p,au_cpb_removal_delay_length_minus1:m,dpb_output_delay_length_minus1:f,fixed_pic_rate_general_flag:g,fixed_pic_rate_within_cvs_flag:y,elemental_duration_in_tc_minus1:v,low_delay_hrd_flag:b,cpb_cnt_minus1:w,nalHrdParameters:S,vclHrdParameters:x}}(d,s[e],m)}let k=!!d.next();return{vps_video_parameter_set_id:c,vps_base_layer_internal_flag:u,vps_base_layer_available_flag:h,vps_max_layers_minus1:p,vps_max_sub_layers_minus1:m,vps_temporal_id_nesting_flag:f,profileTierLevel:g,vps_sub_layer_ordering_info_present_flag:y,vps_max_dec_pic_buffering_minus1:v,vps_max_num_reorder_pics:b,vps_max_latency_increase_plus1:w,vps_max_layer_id:S,vps_num_layer_sets_minus1:x,layer_id_included_flag:L,vps_timing_info_present_flag:E,vps_num_units_in_tick:t,vps_time_scale:i,vps_poc_proportional_to_timing_flag:r,vps_num_ticks_poc_diff_one_minus1:n,vps_num_hrd_parameters:o,hrd_layer_set_idx:a,cprms_present_flag:s,hrdParameters:l,vps_extension_flag:k}}function el(e){let t,i,r,n,o,a,s,l,d,c,u,h,p,m,f,g,y,v,b,w,S,x,L,E,k,C,T;let A=new en(e),P=A.read(4),D=A.read(3),N=!!A.next(),M=ec(A,!0,D),_=A.decodeExponentialGolombNumber(),O=A.decodeExponentialGolombNumber();3===O&&(t=!!A.next());let z=A.decodeExponentialGolombNumber(),R=A.decodeExponentialGolombNumber(),F=!!A.next();F&&(i=A.decodeExponentialGolombNumber(),r=A.decodeExponentialGolombNumber(),n=A.decodeExponentialGolombNumber(),o=A.decodeExponentialGolombNumber());let U=A.decodeExponentialGolombNumber(),I=A.decodeExponentialGolombNumber(),H=A.decodeExponentialGolombNumber(),j=!!A.next();for(let e=j?0:D;e<=D;e+=1){a=[],s=[],l=[];for(let e=0;e<=D;e+=1)a[e]=A.decodeExponentialGolombNumber(),s[e]=A.decodeExponentialGolombNumber(),l[e]=A.decodeExponentialGolombNumber()}let B=A.decodeExponentialGolombNumber(),G=A.decodeExponentialGolombNumber(),V=A.decodeExponentialGolombNumber(),K=A.decodeExponentialGolombNumber(),W=A.decodeExponentialGolombNumber(),Z=A.decodeExponentialGolombNumber(),Y=!!A.next();Y&&(d=!!A.next())&&(c=function(e){let t=[];for(let i=0;i<4;i+=1){t[i]=[];for(let r=0;r<6;r+=3===i?3:1){let n=!!e.next();if(n){let n=8,o=Math.min(64,1<<4+(i<<1));if(i>1){let t=e.decodeExponentialGolombNumber();n=t+8}t[i][r]=[];for(let a=0;a<o;a+=1){let o=e.decodeExponentialGolombNumber();n=(n+o+256)%256,t[i][r][a]=n}}else e.decodeExponentialGolombNumber()}}return t}(A));let q=!!A.next(),X=!!A.next(),J=!!A.next();J&&(u=A.read(4),h=A.read(4),p=A.read(4),m=A.read(4),f=!!A.next());let $=A.decodeExponentialGolombNumber(),Q=[];for(let e=0;e<$;e+=1)Q[e]=function(e,t,i,r){let n=!1;0!==t&&(n=!!e.next());let o=0,a=!1,s=0,l=[],d=[],c=0,u=0,h=[],p=[],m=[],f=[];if(n){t===i&&(o=e.decodeExponentialGolombNumber()),a=!!e.next(),s=e.decodeExponentialGolombNumber();let n=t-(o+1),g=r[n],y=g.num_negative_pics+g.num_positive_pics;for(let t=0;t<=y;t+=1)l[t]=!!e.next(),l[t]?d[t]=!0:d[t]=!!e.next();let v=(1-2*Number(a))*(s+1),b=[],w=[],S=[],x=[],L=0;for(let e=0;e<g.num_negative_pics;e+=1)L-=g.delta_poc_s0_minus1[e]+1,b[e]=L;L=0;for(let e=0;e<g.num_positive_pics;e+=1)L+=g.delta_poc_s1_minus1[e]+1,w[e]=L;let E=0;if(g.num_positive_pics>0)for(let e=g.num_positive_pics-1;e>=0;e-=1)(L=w[e]+v)<0&&d[g.num_negative_pics+e]&&(S[E]=L,p[E]=l[g.num_negative_pics+e],E+=1);v<0&&d[y]&&(S[E]=v,p[E]=l[y],E+=1);for(let e=0;e<g.num_negative_pics;e+=1)(L=b[e]+v)<0&&d[e]&&(S[E]=L,p[E]=l[e],E+=1);c=E;let k=0;for(E=0;E<c;E+=1){let e=S[E];h[E]=-(e-k-1),k=e}if(E=0,g.num_negative_pics>0)for(let e=g.num_negative_pics-1;e>=0;e-=1)(L=b[e]+v)>0&&d[e]&&(x[E]=L,f[E]=l[e],E+=1);v>0&&d[y]&&(x[E]=v,f[E]=l[y],E+=1);for(let e=0;e<g.num_positive_pics;e+=1)(L=w[e]+v)>0&&d[g.num_negative_pics+e]&&(x[E]=L,f[E]=l[g.num_negative_pics+e],E+=1);for(u=E,k=0,E=0;E<u;E+=1){let e=x[E];m[E]=e-k-1,k=e}}else{c=e.decodeExponentialGolombNumber(),u=e.decodeExponentialGolombNumber();for(let t=0;t<c;t+=1)h[t]=e.decodeExponentialGolombNumber(),p[t]=!!e.next();for(let t=0;t<u;t+=1)m[t]=e.decodeExponentialGolombNumber(),f[t]=!!e.next()}return{stRpsIdx:t,num_short_term_ref_pic_sets:i,inter_ref_pic_set_prediction_flag:n,delta_idx_minus1:o,delta_rps_sign:a,abs_delta_rps_minus1:s,used_by_curr_pic_flag:l,use_delta_flag:d,num_negative_pics:c,num_positive_pics:u,delta_poc_s0_minus1:h,used_by_curr_pic_s0_flag:p,delta_poc_s1_minus1:m,used_by_curr_pic_s1_flag:f}}(A,e,$,Q);let ee=!!A.next();if(ee){g=A.decodeExponentialGolombNumber(),y=[],v=[];for(let e=0;e<g;e+=1)y[e]=A.read(H+4),v[e]=!!A.next()}let et=!!A.next(),ei=!!A.next(),er=!!A.next();er&&(b=function(e){let t,i,r,n,o,a,s,l,d,c,u,h,p,m,f,g,y,v,b,w,S,x,L,E,k,C,T,A,P;let D=!!e.next();D&&255===(t=e.read(8))&&(i=e.read(16),r=e.read(16));let N=!!e.next();N&&(n=!!e.next());let M=!!e.next();M&&(o=e.read(3),a=!!e.next(),(s=!!e.next())&&(l=e.read(8),d=e.read(8),c=e.read(8)));let _=!!e.next();_&&(u=e.decodeExponentialGolombNumber(),h=e.decodeExponentialGolombNumber());let O=!!e.next(),z=!!e.next(),R=!!e.next(),F=!!e.next();F&&(p=e.decodeExponentialGolombNumber(),m=e.decodeExponentialGolombNumber(),f=e.decodeExponentialGolombNumber(),g=e.decodeExponentialGolombNumber());let U=!!e.next();if(U&&(y=e.read(32),v=e.read(32),(b=!!e.next())&&(w=e.decodeExponentialGolombNumber()),S=!!e.next()))throw Error("Not implemented");let I=!!e.next();return I&&(x=!!e.next(),L=!!e.next(),E=!!e.next(),k=e.decodeExponentialGolombNumber(),C=e.decodeExponentialGolombNumber(),T=e.decodeExponentialGolombNumber(),A=e.decodeExponentialGolombNumber(),P=e.decodeExponentialGolombNumber()),{aspect_ratio_info_present_flag:D,aspect_ratio_idc:t,sar_width:i,sar_height:r,overscan_info_present_flag:N,overscan_appropriate_flag:n,video_signal_type_present_flag:M,video_format:o,video_full_range_flag:a,colour_description_present_flag:s,colour_primaries:l,transfer_characteristics:d,matrix_coeffs:c,chroma_loc_info_present_flag:_,chroma_sample_loc_type_top_field:u,chroma_sample_loc_type_bottom_field:h,neutral_chroma_indication_flag:O,field_seq_flag:z,frame_field_info_present_flag:R,default_display_window_flag:F,def_disp_win_left_offset:p,def_disp_win_right_offset:m,def_disp_win_top_offset:f,def_disp_win_bottom_offset:g,vui_timing_info_present_flag:U,vui_num_units_in_tick:y,vui_time_scale:v,vui_poc_proportional_to_timing_flag:b,vui_num_ticks_poc_diff_one_minus1:w,vui_hrd_parameters_present_flag:S,bitstream_restriction_flag:I,tiles_fixed_structure_flag:x,motion_vectors_over_pic_boundaries_flag:L,restricted_ref_pic_lists_flag:E,min_spatial_segmentation_idc:k,max_bytes_per_pic_denom:C,max_bits_per_min_cu_denom:T,log2_max_mv_length_horizontal:A,log2_max_mv_length_vertical:P}}(A));let eo=!!A.next();if(eo&&(w=!!A.next(),S=!!A.next(),x=!!A.next(),L=!!A.next(),E=A.read(4)),w||(S&&(k=function(e){let t=!!e.next();return{inter_view_mv_vert_constraint_flag:t}}(A)),x&&(C=function(e){let t=[],i=[];t[0]=!!e.next(),i[0]=!!e.next();let r=e.decodeExponentialGolombNumber(),n=!!e.next(),o=!!e.next(),a=!!e.next(),s=!!e.next();t[1]=!!e.next(),i[1]=!!e.next();let l=!!e.next(),d=e.decodeExponentialGolombNumber(),c=!!e.next(),u=!!e.next(),h=!!e.next(),p=!!e.next(),m=!!e.next();return{iv_di_mc_enabled_flag:t,iv_mv_scal_enabled_flag:i,log2_ivmc_sub_pb_size_minus3:r,iv_res_pred_enabled_flag:n,depth_ref_enabled_flag:o,vsp_mc_enabled_flag:a,dbbp_enabled_flag:s,tex_mc_enabled_flag:l,log2_texmc_sub_pb_size_minus3:d,intra_contour_enabled_flag:c,intra_dc_only_wedge_enabled_flag:u,cqt_cu_part_pred_enabled_flag:h,inter_dc_only_enabled_flag:p,skip_intra_enabled_flag:m}}(A)),L))throw Error("Not implemented");if(E){T=[];let e=0;for(;!A.ended;)T[e]=!!A.next(),e+=1}return{sps_video_parameter_set_id:P,sps_max_sub_layers_minus1:D,sps_temporal_id_nesting_flag:N,profileTierLevel:M,sps_seq_parameter_set_id:_,chroma_format_idc:O,separate_colour_plane_flag:t,pic_width_in_luma_samples:z,pic_height_in_luma_samples:R,conformance_window_flag:F,conf_win_left_offset:i,conf_win_right_offset:r,conf_win_top_offset:n,conf_win_bottom_offset:o,bit_depth_luma_minus8:U,bit_depth_chroma_minus8:I,log2_max_pic_order_cnt_lsb_minus4:H,sps_sub_layer_ordering_info_present_flag:j,sps_max_dec_pic_buffering_minus1:a,sps_max_num_reorder_pics:s,sps_max_latency_increase_plus1:l,log2_min_luma_coding_block_size_minus3:B,log2_diff_max_min_luma_coding_block_size:G,log2_min_luma_transform_block_size_minus2:V,log2_diff_max_min_luma_transform_block_size:K,max_transform_hierarchy_depth_inter:W,max_transform_hierarchy_depth_intra:Z,scaling_list_enabled_flag:Y,sps_scaling_list_data_present_flag:d,scalingListData:c,amp_enabled_flag:q,sample_adaptive_offset_enabled_flag:X,pcm_enabled_flag:J,pcm_sample_bit_depth_luma_minus1:u,pcm_sample_bit_depth_chroma_minus1:h,log2_min_pcm_luma_coding_block_size_minus3:p,log2_diff_max_min_pcm_luma_coding_block_size:m,pcm_loop_filter_disabled_flag:f,num_short_term_ref_pic_sets:$,shortTermRefPicSets:Q,long_term_ref_pics_present_flag:ee,num_long_term_ref_pics_sps:g,lt_ref_pic_poc_lsb_sps:y,used_by_curr_pic_lt_sps_flag:v,sps_temporal_mvp_enabled_flag:et,strong_intra_smoothing_enabled_flag:ei,vui_parameters_present_flag:er,vuiParameters:b,sps_extension_present_flag:eo,sps_range_extension_flag:w,sps_multilayer_extension_flag:S,sps_3d_extension_flag:x,sps_scc_extension_flag:L,sps_extension_4bits:E,spsMultilayerExtension:k,sps3dExtension:C,sps_extension_data_flag:T}}function ed(e){let t,i,r,n,o,a,s,l,d,c,u;let h=e.read(2),p=!!e.next(),m=e.read(5),f=e.peekBytes(4),g=[];for(let t=0;t<32;t+=1)g[t]=!!e.next();let y=e.peekBytes(6),v=!!e.next(),b=!!e.next(),w=!!e.next(),S=!!e.next();return 4===m||g[4]||5===m||g[5]||6===m||g[6]||7===m||g[7]||8===m||g[8]||9===m||g[9]||10===m||g[10]||11===m||g[11]?(t=!!e.next(),i=!!e.next(),r=!!e.next(),n=!!e.next(),o=!!e.next(),a=!!e.next(),s=!!e.next(),l=!!e.next(),d=!!e.next(),5===m||g[5]||9===m||g[9]||10===m||g[10]||11===m||g[11]?(c=!!e.next(),e.skip(33)):e.skip(34)):2===m||g[2]?(e.skip(7),l=!!e.next(),e.skip(35)):e.skip(43),1===m||g[1]||2===m||g[2]||3===m||g[3]||4===m||g[4]||5===m||g[5]||9===m||g[9]||11===m||g[11]?u=!!e.next():e.skip(1),{profile_space:h,tier_flag:p,profile_idc:m,profileCompatibilitySet:f,profile_compatibility_flag:g,constraintSet:y,progressive_source_flag:v,interlaced_source_flag:b,non_packed_constraint_flag:w,frame_only_constraint_flag:S,max_12bit_constraint_flag:t,max_10bit_constraint_flag:i,max_8bit_constraint_flag:r,max_422chroma_constraint_flag:n,max_420chroma_constraint_flag:o,max_monochrome_constraint_flag:a,intra_constraint_flag:s,one_picture_only_constraint_flag:l,lower_bit_rate_constraint_flag:d,max_14bit_constraint_flag:c,inbld_flag:u}}function ec(e,t,i){let r;t&&(r=ed(e));let n=e.read(8),o=[],a=[];for(let t=0;t<i;t+=1)o[t]=!!e.next(),a[t]=!!e.next();if(i>0)for(let t=i;t<8;t+=1)e.read(2);let s=[],l=[];for(let t=0;t<i;t+=1)o[t]&&(s[t]=ed(e)),a[t]&&(l[t]=e.read(8));return{generalProfileTier:r,general_level_idc:n,sub_layer_profile_present_flag:o,sub_layer_level_present_flag:a,subLayerProfileTier:s,sub_layer_level_idc:l}}function eu(e,t,i){let r=[],n=[],o=[];for(let a=0;a<i;a+=1)r[a]=e.decodeExponentialGolombNumber(),n[a]=e.decodeExponentialGolombNumber(),t>0&&(o[a]=!!e.next());return{bit_rate_value_minus1:r,cpb_size_value_minus1:n,cpb_size_du_value_minus1:[],bit_rate_du_value_minus1:[],cbr_flag:o}}function eh(e){let t,i,r;let n=0;for(let o of er(e)){let e=function(e){let t=new en(e);if(0!==t.next())throw Error("Invalid NALU header");let i=t.read(6),r=t.read(6),n=t.read(3);return{nal_unit_type:i,nuh_layer_id:r,nuh_temporal_id_plus1:n}}(o),a={...e,data:o,rbsp:o.subarray(2)};switch(e.nal_unit_type){case 32:t=a;break;case 33:i=a;break;case 34:r=a;break;default:continue}if(3===(n+=1))return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}}throw Error("Invalid data")}function ep(e){let{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}=eh(e),{profileTierLevel:{generalProfileTier:{profile_space:n,tier_flag:o,profile_idc:a,profileCompatibilitySet:s,constraintSet:l},general_level_idc:d}}=es(t.rbsp),{chroma_format_idc:c,pic_width_in_luma_samples:u,pic_height_in_luma_samples:h,conf_win_left_offset:p=0,conf_win_right_offset:m=0,conf_win_top_offset:f=0,conf_win_bottom_offset:g=0}=el(i.rbsp),y=function(e){switch(e){case 0:case 3:return 1;case 1:case 2:return 2;default:throw Error("Invalid chroma_format_idc")}}(c),v=function(e){switch(e){case 0:case 2:case 3:return 1;case 1:return 2;default:throw Error("Invalid chroma_format_idc")}}(c);return{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r,generalProfileSpace:n,generalProfileIndex:a,generalProfileCompatibilitySet:s,generalTierFlag:o,generalLevelIndex:d,generalConstraintSet:l,encodedWidth:u,encodedHeight:h,cropLeft:p,cropRight:m,cropTop:f,cropBottom:g,croppedWidth:u-y*(p+m),croppedHeight:h-v*(f+g)}}(l=A||(A={}))[l.Baseline=1]="Baseline",l[l.Main=2]="Main",l[l.Extended=4]="Extended",l[l.High=8]="High",l[l.High10=16]="High10",l[l.High422=32]="High422",l[l.High444=64]="High444",l[l.ConstrainedBaseline=65536]="ConstrainedBaseline",l[l.ConstrainedHigh=524288]="ConstrainedHigh",(d=P||(P={}))[d.Level1=1]="Level1",d[d.Level1b=2]="Level1b",d[d.Level11=4]="Level11",d[d.Level12=8]="Level12",d[d.Level13=16]="Level13",d[d.Level2=32]="Level2",d[d.Level21=64]="Level21",d[d.Level22=128]="Level22",d[d.Level3=256]="Level3",d[d.Level31=512]="Level31",d[d.Level32=1024]="Level32",d[d.Level4=2048]="Level4",d[d.Level41=4096]="Level41",d[d.Level42=8192]="Level42",d[d.Level5=16384]="Level5",d[d.Level51=32768]="Level51",d[d.Level52=65536]="Level52",d[d.Level6=131072]="Level6",d[d.Level61=262144]="Level61",d[d.Level62=524288]="Level62",(c=D||(D={}))[c.Main=1]="Main",c[c.Main10=2]="Main10",c[c.MainStill=4]="MainStill",c[c.Main10Hdr10=4096]="Main10Hdr10",c[c.Main10Hdr10Plus=8192]="Main10Hdr10Plus",(u=N||(N={}))[u.MainTierLevel1=1]="MainTierLevel1",u[u.HighTierLevel1=2]="HighTierLevel1",u[u.MainTierLevel2=4]="MainTierLevel2",u[u.HighTierLevel2=8]="HighTierLevel2",u[u.MainTierLevel21=16]="MainTierLevel21",u[u.HighTierLevel21=32]="HighTierLevel21",u[u.MainTierLevel3=64]="MainTierLevel3",u[u.HighTierLevel3=128]="HighTierLevel3",u[u.MainTierLevel31=256]="MainTierLevel31",u[u.HighTierLevel31=512]="HighTierLevel31",u[u.MainTierLevel4=1024]="MainTierLevel4",u[u.HighTierLevel4=2048]="HighTierLevel4",u[u.MainTierLevel41=4096]="MainTierLevel41",u[u.HighTierLevel41=8192]="HighTierLevel41",u[u.MainTierLevel5=16384]="MainTierLevel5",u[u.HighTierLevel5=32768]="HighTierLevel5",u[u.MainTierLevel51=65536]="MainTierLevel51",u[u.HighTierLevel51=131072]="HighTierLevel51",u[u.MainTierLevel52=262144]="MainTierLevel52",u[u.HighTierLevel52=524288]="HighTierLevel52",u[u.MainTierLevel6=1048576]="MainTierLevel6",u[u.HighTierLevel6=2097152]="HighTierLevel6",u[u.MainTierLevel61=4194304]="MainTierLevel61",u[u.HighTierLevel61=8388608]="HighTierLevel61",u[u.MainTierLevel62=16777216]="MainTierLevel62",u[u.HighTierLevel62=33554432]="HighTierLevel62";var em=i(5096);let ef=new em.AU().uint8("type");(h=M||(M={}))[h.Down=0]="Down",h[h.Up=1]="Up",h[h.Move=2]="Move",h[h.Cancel=3]="Cancel",h[h.Outside=4]="Outside",h[h.PointerDown=5]="PointerDown",h[h.PointerUp=6]="PointerUp",h[h.HoverMove=7]="HoverMove",h[h.Scroll=8]="Scroll",h[h.HoverEnter=9]="HoverEnter",h[h.HoverExit=10]="HoverExit",h[h.ButtonPress=11]="ButtonPress",h[h.ButtonRelease=12]="ButtonRelease",(p=_||(_={}))[p.Primary=1]="Primary",p[p.Secondary=2]="Secondary",p[p.Tertiary=4]="Tertiary",p[p.Back=8]="Back",p[p.Forward=16]="Forward",p[p.StylusPrimary=32]="StylusPrimary",p[p.StylusSecondary=64]="StylusSecondary",(m=O||(O={})).Mouse=-1n,m.Finger=-2n,m.VirtualMouse=-3n,m.VirtualFinger=-4n,(f=z||(z={}))[f.InjectKeyCode=0]="InjectKeyCode",f[f.InjectText=1]="InjectText",f[f.InjectTouch=2]="InjectTouch",f[f.InjectScroll=3]="InjectScroll",f[f.BackOrScreenOn=4]="BackOrScreenOn",f[f.ExpandNotificationPanel=5]="ExpandNotificationPanel",f[f.ExpandSettingPanel=6]="ExpandSettingPanel",f[f.CollapseNotificationPanel=7]="CollapseNotificationPanel",f[f.GetClipboard=8]="GetClipboard",f[f.SetClipboard=9]="SetClipboard",f[f.SetScreenPowerMode=10]="SetScreenPowerMode",f[f.RotateDevice=11]="RotateDevice";class eg{#c;constructor(e){this.#c=e.controlMessageTypes}get(e){let t=this.#c.indexOf(e);if(-1===t)throw Error("Not supported");return t}fillMessageType(e,t){return e.type=this.get(t),e}}class ey{#u;process(e){let t=[];return this.#u&&this.#u.pointerId!==e.pointerId&&(t.push({...this.#u,action:M.Up}),this.#u=void 0),e.action===M.HoverMove&&(this.#u=e),e.type=z.InjectTouch,t.push(e),t}}(g=R||(R={}))[g.Down=0]="Down",g[g.Up=1]="Up",(y=F||(F={}))[y.AltOn=2]="AltOn",y[y.AltLeftOn=16]="AltLeftOn",y[y.AltRightOn=32]="AltRightOn",y[y.ShiftOn=1]="ShiftOn",y[y.ShiftLeftOn=64]="ShiftLeftOn",y[y.ShiftRightOn=128]="ShiftRightOn",y[y.CtrlOn=4096]="CtrlOn",y[y.CtrlLeftOn=8192]="CtrlLeftOn",y[y.CtrlRightOn=16384]="CtrlRightOn",y[y.MetaOn=65536]="MetaOn",y[y.MetaLeftOn=131072]="MetaLeftOn",y[y.MetaRightOn=262144]="MetaRightOn",y[y.CapsLockOn=1048576]="CapsLockOn",y[y.NumLockOn=2097152]="NumLockOn",y[y.ScrollLockOn=4194304]="ScrollLockOn",(v=U||(U={}))[v.AndroidHome=3]="AndroidHome",v[v.AndroidBack=4]="AndroidBack",v[v.AndroidCall=5]="AndroidCall",v[v.AndroidEndCall=6]="AndroidEndCall",v[v.Digit0=7]="Digit0",v[v.Digit1=8]="Digit1",v[v.Digit2=9]="Digit2",v[v.Digit3=10]="Digit3",v[v.Digit4=11]="Digit4",v[v.Digit5=12]="Digit5",v[v.Digit6=13]="Digit6",v[v.Digit7=14]="Digit7",v[v.Digit8=15]="Digit8",v[v.Digit9=16]="Digit9",v[v.Star=17]="Star",v[v.Pound=18]="Pound",v[v.ArrowUp=19]="ArrowUp",v[v.ArrowDown=20]="ArrowDown",v[v.ArrowLeft=21]="ArrowLeft",v[v.ArrowRight=22]="ArrowRight",v[v.AndroidDPadCenter=23]="AndroidDPadCenter",v[v.VolumeUp=24]="VolumeUp",v[v.VolumeDown=25]="VolumeDown",v[v.Power=26]="Power",v[v.AndroidCamera=27]="AndroidCamera",v[v.Clear=28]="Clear",v[v.KeyA=29]="KeyA",v[v.KeyB=30]="KeyB",v[v.KeyC=31]="KeyC",v[v.KeyD=32]="KeyD",v[v.KeyE=33]="KeyE",v[v.KeyF=34]="KeyF",v[v.KeyG=35]="KeyG",v[v.KeyH=36]="KeyH",v[v.KeyI=37]="KeyI",v[v.KeyJ=38]="KeyJ",v[v.KeyK=39]="KeyK",v[v.KeyL=40]="KeyL",v[v.KeyM=41]="KeyM",v[v.KeyN=42]="KeyN",v[v.KeyO=43]="KeyO",v[v.KeyP=44]="KeyP",v[v.KeyQ=45]="KeyQ",v[v.KeyR=46]="KeyR",v[v.KeyS=47]="KeyS",v[v.KeyT=48]="KeyT",v[v.KeyU=49]="KeyU",v[v.KeyV=50]="KeyV",v[v.KeyW=51]="KeyW",v[v.KeyX=52]="KeyX",v[v.KeyY=53]="KeyY",v[v.KeyZ=54]="KeyZ",v[v.Comma=55]="Comma",v[v.Period=56]="Period",v[v.AltLeft=57]="AltLeft",v[v.AltRight=58]="AltRight",v[v.ShiftLeft=59]="ShiftLeft",v[v.ShiftRight=60]="ShiftRight",v[v.Tab=61]="Tab",v[v.Space=62]="Space",v[v.AndroidSymbol=63]="AndroidSymbol",v[v.AndroidExplorer=64]="AndroidExplorer",v[v.AndroidEnvelope=65]="AndroidEnvelope",v[v.Enter=66]="Enter",v[v.Backspace=67]="Backspace",v[v.Backquote=68]="Backquote",v[v.Minus=69]="Minus",v[v.Equal=70]="Equal",v[v.BracketLeft=71]="BracketLeft",v[v.BracketRight=72]="BracketRight",v[v.Backslash=73]="Backslash",v[v.Semicolon=74]="Semicolon",v[v.Quote=75]="Quote",v[v.Slash=76]="Slash",v[v.At=77]="At",v[v.AndroidNum=78]="AndroidNum",v[v.AndroidHeadsetHook=79]="AndroidHeadsetHook",v[v.AndroidFocus=80]="AndroidFocus",v[v.Plus=81]="Plus",v[v.ContextMenu=82]="ContextMenu",v[v.AndroidNotification=83]="AndroidNotification",v[v.AndroidSearch=84]="AndroidSearch",v[v.PageUp=92]="PageUp",v[v.PageDown=93]="PageDown",v[v.Escape=111]="Escape",v[v.Delete=112]="Delete",v[v.ControlLeft=113]="ControlLeft",v[v.ControlRight=114]="ControlRight",v[v.CapsLock=115]="CapsLock",v[v.ScrollLock=116]="ScrollLock",v[v.MetaLeft=117]="MetaLeft",v[v.MetaRight=118]="MetaRight",v[v.AndroidFunction=119]="AndroidFunction",v[v.PrintScreen=120]="PrintScreen",v[v.Pause=121]="Pause",v[v.Home=122]="Home",v[v.End=123]="End",v[v.Insert=124]="Insert",v[v.AndroidForward=125]="AndroidForward",v[v.F1=131]="F1",v[v.F2=132]="F2",v[v.F3=133]="F3",v[v.F4=134]="F4",v[v.F5=135]="F5",v[v.F6=136]="F6",v[v.F7=137]="F7",v[v.F8=138]="F8",v[v.F9=139]="F9",v[v.F10=140]="F10",v[v.F11=141]="F11",v[v.F12=142]="F12",v[v.NumLock=143]="NumLock",v[v.Numpad0=144]="Numpad0",v[v.Numpad1=145]="Numpad1",v[v.Numpad2=146]="Numpad2",v[v.Numpad3=147]="Numpad3",v[v.Numpad4=148]="Numpad4",v[v.Numpad5=149]="Numpad5",v[v.Numpad6=150]="Numpad6",v[v.Numpad7=151]="Numpad7",v[v.Numpad8=152]="Numpad8",v[v.Numpad9=153]="Numpad9",v[v.NumpadDivide=154]="NumpadDivide",v[v.NumpadMultiply=155]="NumpadMultiply",v[v.NumpadSubtract=156]="NumpadSubtract",v[v.NumpadAdd=157]="NumpadAdd",v[v.NumpadDecimal=158]="NumpadDecimal",v[v.NumpadComma=159]="NumpadComma",v[v.NumpadEnter=160]="NumpadEnter",v[v.NumpadEquals=161]="NumpadEquals",v[v.NumpadLeftParen=162]="NumpadLeftParen",v[v.NumpadRightParen=163]="NumpadRightParen",v[v.VolumeMute=164]="VolumeMute",v[v.AndroidAppSwitch=187]="AndroidAppSwitch",v[v.AndroidCut=277]="AndroidCut",v[v.AndroidCopy=278]="AndroidCopy",v[v.AndroidPaste=279]="AndroidPaste";let ev=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint32("keyCode").uint32("repeat").uint32("metaState"),eb=new em.ZP().uint8("type").uint32("length").string("text",{lengthField:"length"});(b=I||(I={}))[b.Off=0]="Off",b[b.Normal=2]="Normal";let ew=new em.ZP().uint8("type").uint8("mode",(0,em.W$)());class eS{#h;#p;#m;constructor(e){this.#h=e,this.#p=new eg(e),this.#m=e.createScrollController()}injectKeyCode(e){return ev.serialize(this.#p.fillMessageType(e,z.InjectKeyCode))}injectText(e){return eb.serialize({text:e,type:this.#p.get(z.InjectText)})}injectTouch(e){return this.#h.serializeInjectTouchControlMessage(this.#p.fillMessageType(e,z.InjectTouch))}injectScroll(e){return this.#m.serializeScrollMessage(this.#p.fillMessageType(e,z.InjectScroll))}backOrScreenOn(e){return this.#h.serializeBackOrScreenOnControlMessage({action:e,type:this.#p.get(z.BackOrScreenOn)})}setScreenPowerMode(e){return ew.serialize({mode:e,type:this.#p.get(z.SetScreenPowerMode)})}rotateDevice(){return ef.serialize({type:this.#p.get(z.RotateDevice)})}}var ex=i(7614);class eL{#f;#g;constructor(e,t){this.#f=e,this.#g=new eS(t)}async write(e){await ex.ConsumableWritableStream.write(this.#f,e)}async injectKeyCode(e){await this.write(this.#g.injectKeyCode(e))}async injectText(e){await this.write(this.#g.injectText(e))}async injectTouch(e){await this.write(this.#g.injectTouch(e))}async injectScroll(e){let t=this.#g.injectScroll(e);t&&await this.write(t)}async backOrScreenOn(e){let t=this.#g.backOrScreenOn(e);t&&await this.write(t)}async setScreenPowerMode(e){await this.write(this.#g.setScreenPowerMode(e))}async rotateDevice(){await this.write(this.#g.rotateDevice())}releaseLock(){this.#f.releaseLock()}async close(){await this.#f.close()}}(w=H||(H={}))[w.Clipboard=0]="Clipboard",w[w.AckClipboard=1]="AckClipboard";let eE=new em.ZP().uint64("sequence").extra({type:H.AckClipboard}),ek=new em.ZP().uint32("length").string("content",{lengthField:"length"}).extra({type:H.Clipboard});class eC extends ex.BufferedTransformStream{constructor(){super(async e=>{try{let t=await e.readExactly(1);switch(t[0]){case H.Clipboard:return await ek.deserialize(e);case H.AckClipboard:return await eE.deserialize(e);default:throw Error("Unsupported control message type")}}catch(e){if(e instanceof em.tb)throw new em.oU;if(e instanceof em.oU)throw new em.hy;throw e}})}}let eT={repeatPreviousFrameAfter:"long",maxPtsGapToEncoder:"long"};class eA{options;constructor(e={}){for(let[t,i]of Object.entries(e))if("number"!=typeof i)throw Error(`Invalid option value for ${t}: ${String(i)}`);this.options=e}toOptionValue(){let e=Object.entries(this.options).filter(([,e])=>void 0!==e);if(0!==e.length)return e.map(([e,t])=>{let i=e.replace(/([A-Z])/g,"-$1").toLowerCase(),r=eT[e];return r&&(i+=`:${r}`),i+=`=${t}`}).join(",")}}function eP(e,t,i){return e<t?t:e>i?i:e}let eD=new em.Pl({size:2,signed:!1,deserialize(e,t){let i=em.ek.Uint16.deserialize(e,t);return 65535===i?1:i/65536},serialize(e,t,i,r){i=1===(i=eP(i,-1,1))?65535:65536*i,em.ek.Uint16.serialize(e,t,i,r)}});(S=j||(j={})).Debug="debug",S.Info="info",S.Warn="warn",S.Error="error",(x=B||(B={}))[x.Unlocked=-1]="Unlocked",x[x.Portrait=0]="Portrait",x[x.Landscape=1]="Landscape",x[x.PortraitFlipped=2]="PortraitFlipped",x[x.LandscapeFlipped=3]="LandscapeFlipped";let eN=[z.InjectKeyCode,z.InjectText,z.InjectTouch,z.InjectScroll,z.BackOrScreenOn,z.ExpandNotificationPanel,z.CollapseNotificationPanel,z.GetClipboard,z.SetClipboard,z.SetScreenPowerMode,z.RotateDevice],eM=new em.ZP().uint64("pts").uint32("size").uint8Array("data",{lengthField:"size"}),e_=1n<<63n,eO=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",eD).uint32("buttons"),ez=new em.ZP().uint8("type").uint32("length").string("content",{lengthField:"length"});(L=G||(G={}))[L.H264=1748121140]="H264",L[L.H265=1748121141]="H265",L[L.AV1=6387249]="AV1";class eR{static OPUS=new eR("opus",1869641075,"audio/opus","opus");static AAC=new eR("aac",6381923,"audio/aac","mp4a.66");static RAW=new eR("raw",7496055,"audio/raw","1");optionValue;metadataValue;mimeType;webCodecId;constructor(e,t,i,r){this.optionValue=e,this.metadataValue=t,this.mimeType=i,this.webCodecId=r}toOptionValue(){return this.optionValue}}let eF="/data/local/tmp/scrcpy-server.jar";function eU(e,t){var i;if("object"==typeof(i=e)&&null!==i&&"toOptionValue"in i&&"function"==typeof i.toOptionValue&&(e=e.toOptionValue()),void 0===e)return t;if("string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e)throw Error(`Invalid option value: ${String(e)}`);return String(e)}class eI{_base;get controlMessageTypes(){return this._base.controlMessageTypes}value;constructor(e,t){this._base=e,this.value=t,this.#y()}#y(){Object.assign(this._base,{value:this.value}),this._base instanceof eI&&this._base.#y()}setListEncoders(){this._base.setListEncoders()}setListDisplays(){this._base.setListDisplays()}parseEncoder(e){return this._base.parseEncoder(e)}parseDisplay(e){return this._base.parseDisplay(e)}parseVideoStreamMetadata(e){return this._base.parseVideoStreamMetadata(e)}parseAudioStreamMetadata(e){return this._base.parseAudioStreamMetadata(e)}createMediaStreamTransformer(){return this._base.createMediaStreamTransformer()}serializeInjectTouchControlMessage(e){return this._base.serializeInjectTouchControlMessage(e)}serializeBackOrScreenOnControlMessage(e){return this._base.serializeBackOrScreenOnControlMessage(e)}serializeSetClipboardControlMessage(e){return this._base.serializeSetClipboardControlMessage(e)}createScrollController(){return this._base.createScrollController()}}let eH=new em.ZP().uint8("type").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").int32("scrollX").int32("scrollY");class ej{#v=0;#b=0;processMessage(e){this.#v+=e.scrollX,this.#b+=e.scrollY;let t=0,i=0;if(this.#v>=1?(t=1,this.#v=0):this.#v<=-1&&(t=-1,this.#v=0),this.#b>=1?(i=1,this.#b=0):this.#b<=-1&&(i=-1,this.#b=0),0!==t||0!==i)return e.scrollX=t,e.scrollY=i,e}serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eH.serialize(t)}}class eB{static DEFAULTS={logLevel:j.Debug,maxSize:0,bitRate:8e6,maxFps:0,lockVideoOrientation:B.Unlocked,tunnelForward:!1,crop:"",sendFrameMeta:!0,control:!0,displayId:0,showTouches:!1,stayAwake:!1,codecOptions:new eA};static SERIALIZE_ORDER=["logLevel","maxSize","bitRate","maxFps","lockVideoOrientation","tunnelForward","crop","sendFrameMeta","control","displayId","showTouches","stayAwake","codecOptions"];static serialize(e,t){return t.map(t=>eU(e[t],"-"))}static async parseCString(e,t){let i=(0,em.FO)(await e.readExactly(t));return i.substring(0,i.indexOf("\x00"))}static async parseUint16BE(e){let t=await e.readExactly(em.ek.Uint16.size);return em.ek.Uint16.deserialize(t,!1)}static async parseUint32BE(e){let t=await e.readExactly(em.ek.Uint32.size);return em.ek.Uint32.deserialize(t,!1)}value;defaults=eB.DEFAULTS;controlMessageTypes=eN;constructor(e){this.value={...eB.DEFAULTS,...e}}serialize(){return eB.serialize(this.value,eB.SERIALIZE_ORDER)}setListEncoders(){throw Error("Not supported")}setListDisplays(){this.value.displayId=-1}parseEncoder(){throw Error("Not supported")}parseDisplay(e){let t=e.match(/\s+scrcpy --display (\d+)/);if(t)return{id:Number.parseInt(t[1],10)}}parseVideoStreamMetadata(e){return(async()=>{let t=new ex.BufferedReadableStream(e),i={codec:G.H264};return i.deviceName=await eB.parseCString(t,64),i.width=await eB.parseUint16BE(t),i.height=await eB.parseUint16BE(t),{stream:t.release(),metadata:i}})()}parseAudioStreamMetadata(){throw Error("Not supported")}createMediaStreamTransformer(){if(!this.value.sendFrameMeta)return new ex.TransformStream({transform(e,t){t.enqueue({type:"data",data:e})}});let e=new ex.StructDeserializeStream(eM);return{writable:e.writable,readable:e.readable.pipeThrough(new ex.TransformStream({transform(e,t){if(e.pts===e_){t.enqueue({type:"configuration",data:e.data});return}t.enqueue({type:"data",pts:e.pts,data:e.data})}}))}}serializeInjectTouchControlMessage(e){return eO.serialize(e)}serializeBackOrScreenOnControlMessage(e){if(e.action===R.Down)return ef.serialize(e)}serializeSetClipboardControlMessage(e){return ez.serialize(e)}createScrollController(){return new ej}}class eG extends eI{static DEFAULTS={...eB.DEFAULTS,encoderName:void 0};static SERIALIZE_ORDER=[...eB.SERIALIZE_ORDER,"encoderName"];static parseEncoder(e,t){let i=e.match(t);if(i)return{type:"video",name:i[1]}}get defaults(){return eG.DEFAULTS}constructor(e){super(new eB(e),{...eG.DEFAULTS,...e})}serialize(){return eB.serialize(this.value,eG.SERIALIZE_ORDER)}setListEncoders(){this.value.encoderName="_"}parseEncoder(e){return eG.parseEncoder(e,/\s+scrcpy --encoder-name '(.*?)'/)}}(E=V||(V={})).Verbose="verbose",E.Debug="debug",E.Info="info",E.Warn="warn",E.Error="error",(k=K||(K={}))[k.Initial=-2]="Initial",k[k.Unlocked=-1]="Unlocked",k[k.Portrait=0]="Portrait",k[k.Landscape=1]="Landscape",k[k.PortraitFlipped=2]="PortraitFlipped",k[k.LandscapeFlipped=3]="LandscapeFlipped";let eV=new em.ZP().concat(ef).uint8("action",(0,em.W$)()),eK=eN.slice();eK.splice(6,0,z.ExpandSettingPanel);let eW={[V.Verbose]:j.Debug,[V.Debug]:j.Debug,[V.Info]:j.Info,[V.Warn]:j.Warn,[V.Error]:j.Error},eZ={[K.Initial]:B.Unlocked,[K.Unlocked]:B.Unlocked,[K.Portrait]:B.Portrait,[K.Landscape]:B.Landscape,[K.PortraitFlipped]:B.PortraitFlipped,[K.LandscapeFlipped]:B.LandscapeFlipped};class eY extends eI{static DEFAULTS={...eG.DEFAULTS,logLevel:V.Debug,lockVideoOrientation:K.Unlocked,powerOffOnClose:!1};static SERIALIZE_ORDER=[...eG.SERIALIZE_ORDER,"powerOffOnClose"];get defaults(){return eY.DEFAULTS}get controlMessageTypes(){return eK}constructor(e){let t={...eY.DEFAULTS,...e};super(new eG({...e,logLevel:eW[t.logLevel],lockVideoOrientation:eZ[t.lockVideoOrientation]}),t)}serialize(){return eB.serialize(this.value,eY.SERIALIZE_ORDER)}parseEncoder(e){return eG.parseEncoder(e,/\s+scrcpy --encoder '(.*?)'/)}serializeBackOrScreenOnControlMessage(e){return eV.serialize(e)}}let eq=new em.ZP().uint8("type").uint64("sequence").int8("paste",(0,em.W$)()).uint32("length").string("content",{lengthField:"length"});class eX extends eI{static DEFAULTS={...eY.DEFAULTS,clipboardAutosync:!0};static serialize(e,t){let i=[];for(let[r,n]of Object.entries(e)){let e=eU(n,void 0);if(!e)continue;let o=eU(t[r],void 0);e!=o&&i.push(`${r.replace(/([A-Z])/g,"_$1").toLowerCase()}=${e}`)}return i}get defaults(){return eX.DEFAULTS}constructor(e){super(new eY(e),{...eX.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}serializeSetClipboardControlMessage(e){return eq.serialize(e)}}let eJ=new em.ZP().concat(eH).int32("buttons");class e$ extends ej{serializeScrollMessage(e){let t=this.processMessage(e);if(t)return eJ.serialize(t)}}class eQ extends eI{static DEFAULTS={...eX.DEFAULTS,downsizeOnError:!0,sendDeviceMeta:!0,sendDummyByte:!0};get defaults(){return eQ.DEFAULTS}constructor(e){super(new eX(e),{...eQ.DEFAULTS,...e})}parseVideoStreamMetadata(e){return this.value.sendDeviceMeta?this._base.parseVideoStreamMetadata(e):{stream:e,metadata:{codec:G.H264}}}serialize(){return eX.serialize(this.value,this.defaults)}createScrollController(){return new e$}}let e0=1n<<62n;class e1 extends eI{static DEFAULTS={...eQ.DEFAULTS,cleanup:!0};get defaults(){return e1.DEFAULTS}constructor(e){super(new eQ(e),{...e1.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}createMediaStreamTransformer(){let e=this._base.createMediaStreamTransformer();return{writable:e.writable,readable:e.readable.pipeThrough(new ex.TransformStream({transform(e,t){if("data"!==e.type){t.enqueue(e);return}void 0!==e.pts&&e.pts&e0&&(e.keyframe=!0,e.pts&=~e0),t.enqueue(e)}}))}}}class e2 extends eI{static DEFAULTS={...e1.DEFAULTS,powerOn:!0};get defaults(){return e2.DEFAULTS}constructor(e){super(new e1(e),{...e2.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}}let e6=new em.Pl({size:2,signed:!0,deserialize(e,t){let i=em.ek.Int16.deserialize(e,t);return 32767===i?1:i/32768},serialize(e,t,i,r){i=1===(i=eP(i,-1,1))?32767:32768*i,em.ek.Int16.serialize(e,t,i,r)}}),e3=new em.ZP().uint8("type",z.InjectScroll).uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("scrollX",e6).field("scrollY",e6).int32("buttons");class e4{serializeScrollMessage(e){return e3.serialize(e)}}class e8 extends eI{get defaults(){return e2.DEFAULTS}constructor(e){super(new e2(e),{...e2.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}createScrollController(){return new e4}}let e5=new em.ZP().uint8("type").uint8("action",(0,em.W$)()).uint64("pointerId").uint32("pointerX").uint32("pointerY").uint16("screenWidth").uint16("screenHeight").field("pressure",eD).uint32("actionButton").uint32("buttons");class e7{static NONE=new e7(-1);static random(){return new e7(2147483648*Math.random()|0)}value;constructor(e){this.value=e}toOptionValue(){if(!(this.value<0))return this.value.toString(16)}}class e9 extends eI{static DEFAULTS={...function(e,t){let i={};for(let r in e)t.includes(r)||(i[r]=e[r]);return i}(e2.DEFAULTS,["bitRate","codecOptions","encoderName"]),scid:e7.NONE,videoCodec:"h264",videoBitRate:8e6,videoCodecOptions:new eA,videoEncoder:"",audio:!0,audioCodec:"opus",audioBitRate:128e3,audioCodecOptions:new eA,audioEncoder:"",listEncoders:!1,listDisplays:!1,sendCodecMeta:!0};get defaults(){return e9.DEFAULTS}constructor(e){super(new e8(e),{...e9.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}setListEncoders(){this.value.listEncoders=!0}setListDisplays(){this.value.listDisplays=!0}parseEncoder(e){let t=e.match(/\s+--video-codec=(.*)\s+--video-encoder='(.*)'/);return t?{type:"video",codec:t[1],name:t[2]}:(t=e.match(/\s+--audio-codec=(.*)\s+--audio-encoder='(.*)'/))?{type:"audio",codec:t[1],name:t[2]}:void 0}parseDisplay(e){let t=e.match(/\s+--display=(\d+)\s+\((.*?)\)/);if(t){let e={id:Number.parseInt(t[1],10)};return"size unknown"!==t[2]&&(e.resolution=t[2]),e}}parseVideoStreamMetadata(e){let{sendDeviceMeta:t,sendCodecMeta:i}=this.value;if(!t&&!i){let t;switch(this.value.videoCodec){case"h264":t=G.H264;break;case"h265":t=G.H265;break;case"av1":t=G.AV1}return{stream:e,metadata:{codec:t}}}return(async()=>{let r,n,o,a;let s=new ex.BufferedReadableStream(e);if(t&&(r=await eB.parseCString(s,64)),i)n=await eB.parseUint32BE(s),o=await eB.parseUint32BE(s),a=await eB.parseUint32BE(s);else switch(this.value.videoCodec){case"h264":n=G.H264;break;case"h265":n=G.H265;break;case"av1":n=G.AV1}return{stream:s.release(),metadata:{deviceName:r,codec:n,width:o,height:a}}})()}parseAudioStreamMetadata(e){return(async()=>{let t;let i=new ex.BufferedReadableStream(e),r=await i.readExactly(em.ek.Uint32.size),n=em.ek.Uint32.deserialize(r,!1);switch(n){case 0:return{type:"disabled"};case 1:return{type:"errored"}}if(this.value.sendCodecMeta){let e;switch(n){case eR.OPUS.metadataValue:e=eR.OPUS;break;case eR.AAC.metadataValue:e=eR.AAC;break;case eR.RAW.metadataValue:e=eR.RAW;break;default:throw Error(`Unknown audio codec metadata value: ${n}`)}return{type:"success",codec:e,stream:i.release()}}switch(this.value.audioCodec){case"opus":t=eR.OPUS;break;case"aac":t=eR.AAC;break;case"raw":t=eR.RAW}return{type:"success",codec:t,stream:new ex.PushReadableStream(async e=>{await e.enqueue(r);let t=i.release(),n=t.getReader();for(;;){let{done:t,value:i}=await n.read();if(t)break;await e.enqueue(i)}})}})()}serializeInjectTouchControlMessage(e){return e5.serialize(e)}}class te extends eI{static DEFAULTS={...e9.DEFAULTS,video:!0,audioSource:"output"};get defaults(){return te.DEFAULTS}constructor(e){super(new e9(e),{...te.DEFAULTS,...e})}serialize(){return eX.serialize(this.value,this.defaults)}}let tt=V,ti=K;class tr extends te{}function tn(e){return e.toString(16).padStart(2,"0").toUpperCase()}function to(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}class ta{static isSupported(){return void 0!==globalThis.VideoDecoder}static capabilities={h264:{},h265:{}};#w;get codec(){return this.#w}#S;get writable(){return this.#S}#x;get renderer(){return this.#x}#L=0;get frameRendered(){return this.#L}#E=0;get frameSkipped(){return this.#E}#k;#C;#T;#A=!1;#P=0;constructor(e){this.#w=e,this.#x=document.createElement("canvas"),this.#k=this.#x.getContext("2d"),this.#C=new VideoDecoder({output:e=>{this.#A?this.#E+=1:(this.#A=!0,this.#L+=1),this.#k.drawImage(e,0,0),e.close()},error(e){}}),this.#S=new ex.WritableStream({write:e=>{switch(e.type){case"configuration":this.#D(e.data);break;case"data":this.#N(e)}}}),this.#M()}#M=()=>{this.#A=!1,this.#P=requestAnimationFrame(this.#M)};#D(e){switch(this.#w){case G.H264:{let{profileIndex:t,constraintSet:i,levelIndex:r,croppedWidth:n,croppedHeight:o}=ea(e);this.#x.width=n,this.#x.height=o;let a=`avc1.${[t,i,r].map(tn).join("")}`;this.#C.configure({codec:a,optimizeForLatency:!0});break}case G.H265:{let{generalProfileSpace:t,generalProfileIndex:i,generalProfileCompatibilitySet:r,generalTierFlag:n,generalLevelIndex:o,generalConstraintSet:a,croppedWidth:s,croppedHeight:l}=ep(e);this.#x.width=s,this.#x.height=l;let d=["hev1",["","A","B","C"][t]+i.toString(),to(r,0).toString(16),(n?"H":"L")+o.toString(),to(a,0).toString(16).toUpperCase(),to(a,4).toString(16).toUpperCase()].join(".");this.#C.configure({codec:d,optimizeForLatency:!0})}}this.#T=e}#N(e){let t;"configured"===this.#C.state&&(void 0!==this.#T?((t=new Uint8Array(this.#T.byteLength+e.data.byteLength)).set(this.#T,0),t.set(e.data,this.#T.byteLength),this.#T=void 0):t=e.data,this.#C.decode(new EncodedVideoChunk({type:!1===e.keyframe?"delta":"key",timestamp:0,data:t})))}dispose(){cancelAnimationFrame(this.#P),"closed"!==this.#C.state&&this.#C.close()}}var ts=i(7131),tl=i(2626),td=i(1105),tc=i.n(td),tu=i(8451),th=i(362),tp=i(9987),tm=i(6781),tf=i(4754),tg=i(4679),ty=i(9722);let tv={[G.H264]:"V_MPEG4/ISO/AVC",[G.H265]:"V_MPEGH/ISO/HEVC",[G.AV1]:"V_AV1"},tb={[eR.RAW.mimeType]:"A_PCM/INT/LIT",[eR.AAC.mimeType]:"A_AAC",[eR.OPUS.mimeType]:"A_OPUS"};class tw{addVideoChunk(e){-1===this._firstTimestamp&&(this._firstTimestamp=Number(e.pts));let t=function(e){let t=[],i=0;for(let r of er(e))t.push(r),i+=r.byteLength+4;let r=new Uint8Array(i),n=0;for(let e of t)r[n]=e.byteLength>>24,r[n+1]=e.byteLength>>16,r[n+2]=e.byteLength>>8,r[n+3]=255&e.byteLength,r.set(e,n+4),n+=4+e.byteLength;return r}(e.data);this.muxer.addVideoChunkRaw(t,e.keyframe?"key":"delta",Number(e.pts)-this._firstTimestamp,this.configurationWritten?void 0:{decoderConfig:{codec:"",description:this.videoCodecDescription}}),this.configurationWritten=!0}addVideoPacket(e){if(!this.videoMetadata)throw Error("videoMetadata must be set");try{if("configuration"===e.type){switch(this.videoMetadata.codec){case G.H264:{let{sequenceParameterSet:t,pictureParameterSet:i}=eo(e.data);this.videoCodecDescription=function(e,t){let i=new Uint8Array(11+e.byteLength+t.byteLength);return i[0]=1,i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=255,i[5]=225,i[6]=e.byteLength>>8,i[7]=255&e.byteLength,i.set(e,8),i[8+e.byteLength]=1,i[9+e.byteLength]=t.byteLength>>8,i[10+e.byteLength]=255&t.byteLength,i.set(t,11+e.byteLength),i}(t,i),this.configurationWritten=!1;break}case G.H265:{let{videoParameterSet:t,sequenceParameterSet:i,pictureParameterSet:r}=eh(e.data);this.videoCodecDescription=function(e,t,i){let{profileTierLevel:{generalProfileTier:{profile_space:r,tier_flag:n,profile_idc:o,profileCompatibilitySet:a,constraintSet:s},general_level_idc:l},vps_max_layers_minus1:d,vps_temporal_id_nesting_flag:c}=es(e.rbsp),{chroma_format_idc:u,bit_depth_luma_minus8:h,bit_depth_chroma_minus8:p,vuiParameters:{min_spatial_segmentation_idc:m=0}={}}=el(t.rbsp),f=new Uint8Array(38+e.data.length+t.data.length+i.data.length);f[0]=1,f[1]=r<<6|Number(n)<<5|o,f[2]=a[0],f[3]=a[1],f[4]=a[2],f[5]=a[3],f[6]=s[0],f[7]=s[1],f[8]=s[2],f[9]=s[3],f[10]=s[4],f[11]=s[5],f[12]=l,f[13]=240|m>>8,f[14]=m,f[15]=252,f[16]=252|u,f[17]=248|h,f[18]=248|p,f[19]=0,f[20]=0,f[21]=d+1<<3|Number(c)<<2|3,f[22]=3;let g=23;for(let r of[e,t,i])f[g]=r.nal_unit_type,f[g+=1]=0,f[g+=1]=1,f[g+=1]=r.data.length>>8,f[g+=1]=r.data.length,g+=1,f.set(r.data,g),g+=r.data.length;return f}(t,i,r),this.configurationWritten=!1}}return}if(!0===e.keyframe&&(this._packetsFromLastKeyframe.length=0),this._packetsFromLastKeyframe.push({type:"video",packet:e}),!this.muxer)return;this.addVideoChunk(e)}catch(e){console.error(e)}}addAudioChunk(e){if(-1===this._firstTimestamp)return;let t=Number(e.pts)-this._firstTimestamp;!(t<0)&&this.muxer&&this.muxer.addAudioChunkRaw(e.data,"key",t)}addAudioPacket(e){this._packetsFromLastKeyframe.push({type:"audio",packet:e}),this.addAudioChunk(e)}start(){var e,t;if(!this.videoMetadata)throw Error("videoMetadata must be set");this.running=!0;let i={target:new ty.ArrayBufferTarget,type:"matroska",firstTimestampBehavior:"permissive",video:{codec:tv[this.videoMetadata.codec],width:null!==(e=this.videoMetadata.width)&&void 0!==e?e:0,height:null!==(t=this.videoMetadata.height)&&void 0!==t?t:0}};if(this.audioCodec&&(i.audio={codec:tb[this.audioCodec.mimeType],sampleRate:48e3,numberOfChannels:2,bitDepth:this.audioCodec===eR.RAW?16:void 0}),this.muxer=new ty.Muxer(i),this._packetsFromLastKeyframe.length>0)for(let{type:e,packet:t}of this._packetsFromLastKeyframe)"video"===e?this.addVideoChunk(t):this.addAudioChunk(t)}stop(){if(!this.muxer)return;this.muxer.finalize();let e=this.muxer.target.buffer,t=new Date,i=(0,tf.yH)("Recording ".concat(t.getFullYear(),"-").concat((t.getMonth()+1).toString().padStart(2,"0"),"-").concat(t.getDate().toString().padStart(2,"0")," ").concat(t.getHours().toString().padStart(2,"0"),"-").concat(t.getMinutes().toString().padStart(2,"0"),"-").concat(t.getSeconds().toString().padStart(2,"0"),".mkv")),r=i.getWriter();r.write(new Uint8Array(e)),r.close(),this.muxer=void 0,this.configurationWritten=!1,this.running=!1}constructor(){this.running=!1,this.configurationWritten=!1,this._firstTimestamp=-1,this._packetsFromLastKeyframe=[]}}let tS=(0,ts.ky)({recorder:new tw,recording:!1,intervalId:-1,hours:0,minutes:0,seconds:0});(0,ts.U5)(()=>tS.recording,e=>{e?tS.intervalId=globalThis.setInterval((0,ts.aD)(()=>{tS.seconds+=1,tS.seconds>=60&&(tS.seconds=0,tS.minutes+=1),tS.minutes>=60&&(tS.minutes=0,tS.hours+=1)}),1e3):(globalThis.clearInterval(tS.intervalId),tS.intervalId=-1,tS.hours=0,tS.minutes=0,tS.seconds=0)});var tx=i(3826),tL=i(9355);class tE extends Error{output;constructor(e){super("scrcpy server exited prematurely"),this.output=e}}class tk{static async pushServer(e,t,i=eF){let r=await e.sync();try{await r.write({filename:i,file:t})}finally{await r.dispose()}}static async start(e,t,i,r){let n,o;try{try{n=r.createConnection(e),await n.initialize()}catch(t){if(t instanceof tx.AdbReverseNotSupportedError)r.tunnelForwardOverride=!0,n=r.createConnection(e),await n.initialize();else throw n=void 0,t}o=await e.subprocess.spawn([`CLASSPATH=${t}`,"app_process","/","com.genymobile.scrcpy.Server",i,...r.serialize()],{protocols:[tx.AdbSubprocessNoneProtocol]});let a=o.stdout.pipeThrough(new ex.DecodeUtf8Stream).pipeThrough(new ex.SplitStringStream("\n")),s=[],l=new ex.AbortController,d=a.pipeTo(new ex.WritableStream({write(e){s.push(e)}}),{signal:l.signal,preventCancel:!0}).catch(e=>{if(!l.signal.aborted)throw e}),c=await Promise.race([o.exit.then(()=>{throw new tE(s)}),n.getStreams()]);return l.abort(),await d,new tk({options:r,process:o,stdout:function(...e){return new ex.PushReadableStream(async t=>{for(let i of e){let e=i.getReader();for(;;){let{done:i,value:r}=await e.read();if(i)break;await t.enqueue(r)}}})}(new ex.PushReadableStream(async e=>{for(let t of s)await e.enqueue(t)}),a),videoStream:c.video,audioStream:c.audio,controlStream:c.control})}catch(e){throw await o?.kill(),e}finally{n?.dispose()}}static async getEncoders(e,t,i,r){return r.setListEncoders(),await r.getEncoders(e,t,i)}static async getDisplays(e,t,i,r){return r.setListDisplays(),await r.getDisplays(e,t,i)}#h;#_;#O;get stdout(){return this.#O}get exit(){return this.#_.exit}#z;get screenWidth(){return this.#z}#R;get screenHeight(){return this.#R}#F;get videoStream(){return this.#F}#U;get audioStream(){return this.#U}#I;get controlMessageWriter(){return this.#I}#H;get deviceMessageStream(){return this.#H}constructor({options:e,process:t,stdout:i,videoStream:r,audioStream:n,controlStream:o}){this.#h=e,this.#_=t,this.#O=i,this.#F=r?this.#j(r):void 0,this.#U=n?this.#B(n):void 0,o&&(this.#I=new eL(o.writable.getWriter(),e),this.#H=o.readable.pipeThrough(new eC))}async #j(e){let{stream:t,metadata:i}=await this.#h.parseVideoStreamMetadata(e);return{stream:t.pipeThrough(this.#h.createMediaStreamTransformer()).pipeThrough(new ex.InspectStream(e=>{if("configuration"===e.type)switch(i.codec){case G.H264:{let{croppedWidth:t,croppedHeight:i}=ea(e.data);this.#z=t,this.#R=i;break}case G.H265:{let{croppedWidth:t,croppedHeight:i}=ep(e.data);this.#z=t,this.#R=i}}})),metadata:i}}async #B(e){let t=await this.#h.parseAudioStreamMetadata(e);switch(t.type){case"disabled":case"errored":return t;case"success":return{...t,stream:t.stream.pipeThrough(this.#h.createMediaStreamTransformer())};default:throw Error(`Unexpected audio metadata type ${t.type}`)}}async close(){await this.#_.kill()}}var tC=i(1893);class tT{adb;options;socketName;constructor(e,t){this.adb=e,this.options=t,this.socketName=this.getSocketName()}initialize(){}getSocketName(){let e="localabstract:scrcpy";return void 0!==this.options.scid&&this.options.scid>=0&&(e+="_"+this.options.scid.toString(16).padStart(8,"0")),e}dispose(){}}class tA extends tT{#G=!1;#V(){return this.adb.createSocket(this.socketName)}async #K(e){for(let t=0;!this.#G&&t<100;t+=1)try{let t=await this.#V();if(e){let e=new ex.BufferedReadableStream(t.readable);return await e.readExactly(1),{readable:e.release(),writable:t.writable}}return t}catch(e){await (0,tC.delay)(100)}throw Error("Can't connect to server after 100 retries")}async getStreams(){let{sendDummyByte:e}=this.options,t={};if(this.options.video){let i=await this.#K(e);t.video=i.readable,e=!1}if(this.options.audio){let i=await this.#K(e);t.audio=i.readable,e=!1}if(this.options.control){let i=await this.#K(e);t.control=i,e=!1}return t}dispose(){this.#G=!0}}class tP extends tT{#W;#Z;async initialize(){await this.adb.reverse.remove(this.socketName).catch(e=>{if(e instanceof tx.AdbReverseNotSupportedError)throw e});let e=new ex.TransformStream;this.#W=e.readable.getReader();let t=e.writable.getWriter();this.#Z=await this.adb.reverse.add(this.socketName,e=>{t.write(e)})}async #Y(){return(await this.#W.read()).value}async getStreams(){let e={};if(this.options.video){let t=await this.#Y();e.video=t.readable}if(this.options.audio){let t=await this.#Y();e.audio=t.readable}if(this.options.control){let t=await this.#Y();e.control=t}return e}dispose(){this.adb.reverse.remove(this.#Z).catch(tx.NOOP)}}class tD extends eI{get defaults(){return this._base.defaults}tunnelForwardOverride=!1;constructor(e){super(e,e.value)}serialize(){return this._base.serialize()}}class tN extends tD{static createConnection(e,t,i){return i?new tA(e,t):new tP(e,t)}static async getEncoders(e,t,i,r){let n=await tk.start(e,t,i,r),o=[];return await n.stdout.pipeTo(new ex.WritableStream({write:e=>{let t=r.parseEncoder(e);t&&o.push(t)}})),o}static async getDisplays(e,t,i,r){try{let n=await tk.start(e,t,i,r);throw await n.close(),Error("Unexpected server output")}catch(e){if(e instanceof tE){let t=[];for(let i of e.output){let e=r.parseDisplay(i);e&&t.push(e)}return t}throw e}}getEncoders(e,t,i){return tN.getEncoders(e,t,i,this)}getDisplays(e,t,i){return tN.getDisplays(e,t,i,this)}createConnection(e){return tN.createConnection(e,{scid:-1,video:!0,audio:!1,control:!0,sendDummyByte:!0},this.tunnelForwardOverride||this.value.tunnelForward)}}class tM extends tD{static async getEncoders(e,t,i,r){try{let n=await tk.start(e,t,i,r);throw await n.close(),Error("Unexpected server output")}catch(e){if(e instanceof tE){let t=[];for(let i of e.output){let e=r.parseEncoder(i);e&&t.push(e)}return t}throw e}}async getEncoders(e,t,i){return tM.getEncoders(e,t,i,this)}getDisplays(e,t,i){return tN.getDisplays(e,t,i,this)}createConnection(e){return tN.createConnection(e,{scid:this.value.scid.value,video:!0,audio:this.value.audio,control:this.value.control,sendDummyByte:this.value.sendDummyByte},this.tunnelForwardOverride||this.value.tunnelForward)}}class t_ extends tD{async getEncoders(e,t,i){return tM.getEncoders(e,t,i,this)}getDisplays(e,t,i){return tN.getDisplays(e,t,i,this)}createConnection(e){return tN.createConnection(e,{scid:this.value.scid.value,video:this.value.video,audio:this.value.audio,control:this.value.control,sendDummyByte:this.value.sendDummyByte},this.tunnelForwardOverride||this.value.tunnelForward)}}class tO extends t_{}let tz="2.1.1",tR=new i.U(i(2821));class tF{#k;#q;#X=[];constructor(e){this.#k=new AudioContext({latencyHint:"interactive",sampleRate:e})}feed(e){if(void 0===this.#q){this.#X.push(e);return}this.feedCore(this.#q,e)}async start(){for(let e of(await this.#k.audioWorklet.addModule(new i.U(i(2097))),this.#q=new AudioWorkletNode(this.#k,this.sourceName,{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.#q.connect(this.#k.destination),this.#X))this.feedCore(this.#q,e);this.#X.length=0}async stop(){this.#q?.disconnect(),this.#q=void 0,await this.#k.close()}}class tU extends tF{sourceName="int16-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:i}=t;e.port.postMessage([i],[i])}}class tI extends tF{sourceName="float32-source-processor";feedCore(e,t){(0!==t.byteOffset||t.byteLength!==t.buffer.byteLength)&&(t=t.slice());let{buffer:i}=t;e.port.postMessage([i],[i])}}class tH extends tF{sourceName="float32-planer-source-processor";feedCore(e,t){let i=t.map(e=>((0!==e.byteOffset||e.byteLength!==e.buffer.byteLength)&&(e=e.slice()),e.buffer));e.port.postMessage(i,i)}}var tj=i(8742);class tB extends ex.TransformStream{constructor(e){let t;super({start(e){t=new AudioDecoder({error(t){console.log("audio decoder error: ",t),e.error(t)},output(t){e.enqueue(Array.from({length:2},(e,i)=>{let r={format:"f32-planar",planeIndex:i},n=new Float32Array(t.allocationSize(r)/Float32Array.BYTES_PER_ELEMENT);return t.copyTo(n,r),n}))}})},transform(i){switch(i.type){case"configuration":t.configure({...e,description:i.data});break;case"data":t.decode(new EncodedAudioChunk({data:i.data,type:"key",timestamp:0}))}},async flush(){await t.flush()}})}}class tG extends ex.TransformStream{constructor(e){let t;super({start(i){(t=new AudioDecoder({error(e){console.log("audio decoder error: ",e),i.error(e)},output(e){let t={format:"f32",planeIndex:0},r=new Float32Array(e.allocationSize(t)/Float32Array.BYTES_PER_ELEMENT);e.copyTo(r,t),i.enqueue(r)}})).configure(e)},transform(e){switch(e.type){case"configuration":break;case"data":if(0===e.data.length)break;t.decode(new EncodedAudioChunk({type:"key",timestamp:0,data:e.data}))}},async flush(){await t.flush()}})}}var tV=i(5537);class tK{get downloaded(){return this._downloaded}get total(){return this._total}get onProgress(){return this.progressEvent.event}async fetch(e){var t;let i=await globalThis.fetch(e);this._total=Number.parseInt(null!==(t=i.headers.get("Content-Length"))&&void 0!==t?t:"0",10),this.progressEvent.fire([this._downloaded,this._total]);let r=i.body.getReader(),n=[];for(;;){let e=await r.read();if(e.done)break;n.push(e.value),this._downloaded+=e.value.byteLength,this.progressEvent.fire([this._downloaded,this._total])}this._total=n.reduce((e,t)=>e+t.byteLength,0);let o=new Uint8Array(this._total),a=0;for(let e of n)o.set(e,a),a+=e.byteLength;return o}constructor(e){this._downloaded=0,this._total=0,this.progressEvent=new tV.vp,this.promise=this.fetch(e)}}function tW(e){return r||(r=new tK(tR)).promise.catch(()=>{r=void 0}),e&&(r.onProgress(e),e([r.downloaded,r.total])),r.promise}var tZ=i(4908);class tY{setModifier(e,t){switch(e){case U.ControlLeft:this._controlLeft=t;break;case U.ControlRight:this._controlRight=t;break;case U.ShiftLeft:this._shiftLeft=t;break;case U.ShiftRight:this._shiftRight=t;break;case U.AltLeft:this._altLeft=t;break;case U.AltRight:this._altRight=t;break;case U.MetaLeft:this._metaLeft=t;break;case U.MetaRight:this._metaRight=t;break;case U.CapsLock:t&&(this._capsLock=!this._capsLock);break;case U.NumLock:t&&(this._numLock=!this._numLock)}}getMetaState(){let e=0;return this._altLeft&&(e|=F.AltOn|F.AltLeftOn),this._altRight&&(e|=F.AltOn|F.AltRightOn),this._shiftLeft&&(e|=F.ShiftOn|F.ShiftLeftOn),this._shiftRight&&(e|=F.ShiftOn|F.ShiftRightOn),this._controlLeft&&(e|=F.CtrlOn|F.CtrlLeftOn),this._controlRight&&(e|=F.CtrlOn|F.CtrlRightOn),this._metaLeft&&(e|=F.MetaOn|F.MetaLeftOn),this._metaRight&&(e|=F.MetaOn|F.MetaRightOn),this._capsLock&&(e|=F.CapsLockOn),this._numLock&&(e|=F.NumLockOn),e}async down(e){var t;let i=U[e];i&&(this.setModifier(i,!0),this._keys.add(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:R.Down,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async up(e){var t;let i=U[e];i&&(this.setModifier(i,!1),this._keys.delete(i),await (null===(t=this.client.controlMessageWriter)||void 0===t?void 0:t.injectKeyCode({action:R.Up,keyCode:i,metaState:this.getMetaState(),repeat:0})))}async reset(){for(let e of(this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._keys))this.up(U[e]);this._keys.clear()}dispose(){}constructor(e){this._controlLeft=!1,this._controlRight=!1,this._shiftLeft=!1,this._shiftRight=!1,this._altLeft=!1,this._altRight=!1,this._metaLeft=!1,this._metaRight=!1,this._capsLock=!1,this._numLock=!0,this._keys=new Set,this.client=e}}class tq{static async register(e){let t=await tZ.qG.register(e,0,tZ.XC.DESCRIPTOR);return new tq(t)}async down(e){let t=tZ.sm[e];t&&(this.hidKeyboard.down(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async up(e){let t=tZ.sm[e];t&&(this.hidKeyboard.up(t),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport()))}async reset(){this.hidKeyboard.reset(),await this.aoaKeyboard.sendInputReport(this.hidKeyboard.serializeInputReport())}async dispose(){await this.aoaKeyboard.unregister()}constructor(e){this.hidKeyboard=new tZ.XC,this.aoaKeyboard=e}}var tX=i(608),tJ=i(4606),t$=i(2384),tQ=i(8142),t0=i(886),t1=i(7353),t2=i(8235),t6=i(8718);let t3=!1,t4=[],t8=0,t5=new Map;class t7 extends tV.Xn{streamId;#J=new tV.vp;get onPictureReady(){return this.#J.event}constructor(e){var t;super(),this.streamId=e,this.addDisposable((t=this.#$,t5.set(e,t),{dispose(){t5.delete(e)}}))}#$=e=>{this.#J.fire(e)};feed(e){n.postMessage({type:"decode",data:e,offset:0,length:e.byteLength,renderStateId:this.streamId},[e])}dispose(){super.dispose(),n.postMessage({type:"release",renderStateId:this.streamId})}}let t9=()=>{};function ie(){return o||(o=Promise.all([i.e(518).then(i.t.bind(i,9518,19)),i.e(282).then(i.t.bind(i,6282,19))]).then(([e,{default:t}])=>({YuvBuffer:e,YuvCanvas:t}))),o}class it{static capabilities={h264:{maxProfile:A.Baseline,maxLevel:P.Level4}};#x;get renderer(){return this.#x}#L=0;get frameRendered(){return this.#L}#E=0;get frameSkipped(){return this.#E}#S;get writable(){return this.#S}#Q;#ee;constructor(){ie(),this.#x=document.createElement("canvas"),this.#S=new ex.WritableStream({write:async e=>{switch(e.type){case"configuration":await this.#D(e.data);break;case"data":{if(!this.#ee)throw Error("Decoder not configured");let t=await this.#ee.promise;t.feed(e.data.slice().buffer)}}}})}async #D(e){this.dispose(),this.#ee=new tC.PromiseResolver;let{YuvBuffer:t,YuvCanvas:r}=await ie();this.#Q||(this.#Q=r.attach(this.#x));let{encodedWidth:o,encodedHeight:a,croppedWidth:s,croppedHeight:l,cropLeft:d,cropTop:c}=ea(e),u=o/2,h=a/2,p=t.format({width:o,height:a,chromaWidth:u,chromaHeight:h,cropLeft:d,cropTop:c,cropWidth:s,cropHeight:l,displayWidth:s,displayHeight:l}),m=await function(){if(n||(n=new Worker(i.tu(new URL(i.p+i.u(651),i.b)))).addEventListener("message",({data:e})=>{switch(e.type){case"decoderReady":for(let e of(t3=!0,t4))e.resolve(new t7(t8)),t8+=1;t4.length=0;break;case"pictureReady":t5.get(e.renderStateId)?.(e)}}),!t3){let e=new tC.PromiseResolver;return t4.push(e),e.promise}let e=new t7(t8);return t8+=1,Promise.resolve(e)}();this.#ee.resolve(m);let f=o*a,g=f+u*h;m.onPictureReady(({data:e})=>{this.#L+=1;let i=new Uint8Array(e),r=t.frame(p,t.lumaPlane(p,i,o,0),t.chromaPlane(p,i,u,f),t.chromaPlane(p,i,u,g));this.#Q.drawFrame(r)}),m.feed(e.slice().buffer)}dispose(){this.#ee?.promise.then(e=>e.dispose()).catch(t9),this.#ee=void 0}}let ii=(0,et.Z)({labelRight:{marginLeft:"4px"},item:{width:"100%",maxWidth:"300px"}}),ir=(0,tl.Pi)(function(e){let{definition:t,value:i,onChange:r}=e,n=ii(),o=(0,W.jsxs)(q.K,{horizontal:!0,verticalAlign:"center",children:[(0,W.jsx)("span",{children:t.label}),!!t.description&&(0,W.jsx)(tX.G,{content:t.description,children:(0,W.jsx)(tJ.J,{className:n.labelRight,iconName:tf.PJ.Info})}),t.labelExtra]});switch(t.type){case"text":return(0,W.jsx)(t$.n,{className:n.item,label:o,placeholder:t.placeholder,value:i,onChange:(e,i)=>r(t,i)});case"dropdown":return(0,W.jsx)(tQ.L,{className:n.item,label:o,options:t.options,placeholder:t.placeholder,selectedKey:i,onChange:(e,i)=>r(t,i.key)});case"toggle":return(0,W.jsx)(t0.Z,{label:o,checked:i,disabled:t.disabled,onChange:(e,i)=>r(t,i)});case"number":return(0,W.jsx)(t1.k,{className:n.item,label:t.label,labelPosition:t2.L.top,min:t.min,max:t.max,step:t.step,value:i.toString(),onChange:(e,i)=>r(t,Number.parseInt(i,10))})}}),io={maxSize:1080,videoBitRate:4e6,videoCodec:"h264",lockVideoOrientation:ti.Unlocked,displayId:0,crop:"",powerOn:!0,audio:!0,audioCodec:"aac"},ia=(0,ts.ky)({displays:[],encoders:[],decoders:[{key:"tinyh264",name:"TinyH264 (Software)",Constructor:it}],settings:io,clientSettings:{}},{decoders:ts.LO.shallow,settings:ts.LO.deep,clientSettings:ts.LO.deep}),is="/data/local/tmp/.tango.json";(0,ts.EH)(()=>{tj.GLOBAL_STATE.adb&&((async()=>{let e=await tj.GLOBAL_STATE.adb.sync();try{let t=JSON.parse(await e.read(is).pipeThrough(new ex.DecodeUtf8Stream).pipeThrough(new ex.ConcatStringStream));(0,ts.z)(()=>{ia.settings={...io,...t.settings},ia.clientSettings=t.clientSettings})}catch(e){if(!(e instanceof tx.AdbSyncError))throw e}finally{await e.dispose()}})(),(0,ts.z)(()=>{ia.encoders=[],ia.displays=[],ia.settings.displayId=void 0}))}),(0,ts.EH)(()=>{ia.clientSettings.decoder=ia.decoders[0].key});let il=(0,ts.Fl)(()=>{let e=[];return e.push({group:"settings",key:"powerOn",type:"toggle",label:"Wake device up on start"},{group:"clientSettings",key:"turnScreenOff",type:"toggle",label:"Turn screen off during mirroring"},{group:"settings",key:"stayAwake",type:"toggle",label:"Stay awake during mirroring (if plugged in)"},{group:"settings",key:"powerOffOnClose",type:"toggle",label:"Turn device off on stop"}),e.push({group:"settings",key:"displayId",type:"dropdown",label:"Display",placeholder:"Press refresh to update available displays",labelExtra:(0,W.jsx)(t6.h,{iconProps:{iconName:tf.PJ.ArrowClockwise},disabled:!tj.GLOBAL_STATE.adb,text:"Refresh",onClick:async()=>{try{await id.pushServer();let e=await tk.getDisplays(tj.GLOBAL_STATE.adb,eF,tz,new tO(new tr({logLevel:tt.Debug})));(0,ts.z)(()=>{if(ia.displays=e,!ia.settings.displayId||!ia.displays.some(e=>e.id===ia.settings.displayId)){var t;ia.settings.displayId=null===(t=ia.displays[0])||void 0===t?void 0:t.id}})}catch(e){tj.GLOBAL_STATE.showErrorDialog(e)}}}),options:ia.displays.map(e=>({key:e.id,text:"".concat(e.id).concat(e.resolution?" (".concat(e.resolution,")"):"")}))}),e.push({group:"settings",key:"crop",type:"text",label:"Crop",placeholder:"W:H:X:Y"}),e.push({group:"settings",key:"maxSize",type:"number",label:"Max Resolution (longer side, 0 = unlimited)",min:0,max:2560,step:50},{group:"settings",key:"videoBitRate",type:"number",label:"Max Video Bitrate (bps)",min:100,max:1e8,step:100},{group:"settings",key:"videoCodec",type:"dropdown",label:"Video Codec",options:[{key:"h264",text:"H.264"},{key:"h265",text:"H.265"}]},{group:"settings",key:"videoEncoder",type:"dropdown",label:"Video Encoder",placeholder:0===ia.encoders.length?"Press refresh button to update encoder list":"(default)",labelExtra:(0,W.jsx)(t6.h,{iconProps:{iconName:tf.PJ.ArrowClockwise},disabled:!tj.GLOBAL_STATE.adb,text:"Refresh",onClick:async()=>{try{await id.pushServer();let e=await tk.getEncoders(tj.GLOBAL_STATE.adb,eF,tz,new tO(new tr({logLevel:tt.Debug})));(0,ts.z)(()=>{ia.encoders=e})}catch(e){tj.GLOBAL_STATE.showErrorDialog(e)}}}),options:ia.encoders.filter(e=>"video"===e.type&&(!e.codec||e.codec===ia.settings.videoCodec)).map(e=>({key:e.name,text:e.name}))}),e.push({group:"settings",key:"lockVideoOrientation",type:"dropdown",label:"Lock Video Orientation",options:[{key:ti.Unlocked,text:"Unlocked"},{key:ti.Initial,text:"Current"},{key:ti.Portrait,text:"Portrait"},{key:ti.Landscape,text:"Landscape"},{key:ti.PortraitFlipped,text:"Portrait (Flipped)"},{key:ti.LandscapeFlipped,text:"Landscape (Flipped)"}]}),ia.decoders.length>1&&e.push({group:"clientSettings",key:"decoder",type:"dropdown",label:"Video Decoder",options:ia.decoders.map(e=>({key:e.key,text:e.name,data:e}))}),e.push({group:"clientSettings",key:"ignoreDecoderCodecArgs",type:"toggle",label:"Ignore video decoder's codec options",description:"Some decoders don't support all H.264 profile/levels, so they request the device to encode at their highest-supported codec. However, some super old devices may not support that codec so their encoders will fail to start. Use this option to let device choose the codec to be used."}),e.push({group:"settings",key:"audio",type:"toggle",label:"Forward Audio (Requires Android 11)"},{group:"settings",key:"audioCodec",type:"dropdown",label:"Audio Codec",options:[{key:"raw",text:"Raw"},{key:"aac",text:"AAC"},{key:"opus",text:"Opus"}]},{group:"settings",key:"audioEncoder",type:"dropdown",placeholder:0===ia.encoders.length?"Press refresh button to update encoder list":"(default)",label:"Audio Encoder",labelExtra:(0,W.jsx)(t6.h,{iconProps:{iconName:tf.PJ.ArrowClockwise},disabled:!tj.GLOBAL_STATE.adb,text:"Refresh",onClick:async()=>{try{await id.pushServer();let e=await tk.getEncoders(tj.GLOBAL_STATE.adb,eF,tz,new tO(new tr({logLevel:tt.Debug})));(0,ts.z)(()=>{ia.encoders=e})}catch(e){tj.GLOBAL_STATE.showErrorDialog(e)}}}),options:ia.encoders.filter(e=>"audio"===e.type&&e.codec===ia.settings.audioCodec).map(e=>({key:e.name,text:e.name}))}),e});(0,ts.EH)(()=>{if(0===ia.encoders.length){ia.settings.videoEncoder="",ia.settings.audioEncoder="";return}let e=ia.encoders.filter(e=>"video"===e.type&&e.codec===ia.settings.videoCodec);ia.settings.videoEncoder&&e.every(e=>e.name!==ia.settings.videoEncoder)&&(ia.settings.videoEncoder="");let t=ia.encoders.filter(e=>"audio"===e.type&&e.codec===ia.settings.audioCodec);ia.settings.audioEncoder&&t.every(e=>e.name!==ia.settings.audioEncoder)&&(ia.settings.audioEncoder="")});let id=new class{get rotatedWidth(){return 1&id.rotation?id.height:id.width}get rotatedHeight(){return 1&id.rotation?id.width:id.height}async pushServer(){let e=await tW();await tk.pushServer(tj.GLOBAL_STATE.adb,new ex.ReadableStream({start(t){t.enqueue(new ex.Consumable(e)),t.close()}}))}async stop(){var e;await (null===(e=this.client)||void 0===e?void 0:e.close()),this.dispose()}dispose(){var e,t,i;null===(e=this.decoder)||void 0===e||e.dispose(),this.decoder=void 0,tS.recording&&(tS.recorder.stop(),tS.recording=!1),null===(t=this.keyboard)||void 0===t||t.dispose(),this.keyboard=void 0,null===(i=this.audioPlayer)||void 0===i||i.stop(),this.audioPlayer=void 0,this.fps="0",clearTimeout(this.fpsCounterIntervalId),this.isFullScreen&&(document.exitFullscreen(),this.isFullScreen=!1),this.client=void 0,this.running=!1}setFullScreenContainer(e){this.fullScreenContainer=e}setRendererContainer(e){this.rendererContainer=e}clientPositionToDevicePosition(e,t){let i=this.rendererContainer.getBoundingClientRect(),r=eP((e-i.x)/i.width,0,1),n=eP((t-i.y)/i.height,0,1);switch(1&this.rotation&&([r,n]=[n,r]),this.rotation){case 1:n=1-n;break;case 2:r=1-r,n=1-n;break;case 3:r=1-r}return{x:r*this.width,y:n*this.height}}constructor(){this.running=!1,this.fullScreenContainer=null,this.rendererContainer=null,this.isFullScreen=!1,this.logVisible=!1,this.log=[],this.demoModeVisible=!1,this.navigationBarVisible=!0,this.width=0,this.height=0,this.rotation=0,this.client=void 0,this.hoverHelper=void 0,this.keyboard=void 0,this.audioPlayer=void 0,this.decoder=void 0,this.fpsCounterIntervalId=void 0,this.fps="0",this.connecting=!1,this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverDownloadSpeed=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.serverUploadSpeed=0,this.start=async()=>{if(tj.GLOBAL_STATE.adb)try{var e,t;let i;if(!ia.clientSettings.decoder)throw Error("No available decoder");(0,ts.z)(()=>{this.serverTotalSize=0,this.serverDownloadedSize=0,this.debouncedServerDownloadedSize=0,this.serverUploadedSize=0,this.debouncedServerUploadedSize=0,this.connecting=!0});let r=setInterval((0,ts.aD)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize}),1e3);try{i=await tW((0,ts.aD)(e=>{let[t,i]=e;this.serverDownloadedSize=t,this.serverTotalSize=i})),(0,ts.z)(()=>{this.serverDownloadSpeed=this.serverDownloadedSize-this.debouncedServerDownloadedSize,this.debouncedServerDownloadedSize=this.serverDownloadedSize})}finally{clearInterval(r)}r=setInterval((0,ts.aD)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize}),1e3);try{await tk.pushServer(tj.GLOBAL_STATE.adb,new ex.ReadableStream({start(e){e.enqueue(new ex.Consumable(i)),e.close()}}).pipeThrough(new ex.DistributionStream(tx.ADB_SYNC_MAX_PACKET_SIZE)).pipeThrough(new tf.hK((0,ts.aD)(e=>{this.serverUploadedSize=e})))),(0,ts.z)(()=>{this.serverUploadSpeed=this.serverUploadedSize-this.debouncedServerUploadedSize,this.debouncedServerUploadedSize=this.serverUploadedSize})}finally{clearInterval(r)}let n=null!==(t=ia.decoders.find(e=>e.key===ia.clientSettings.decoder))&&void 0!==t?t:ia.decoders[0],o=new eA;if(!ia.clientSettings.ignoreDecoderCodecArgs){let e=n.Constructor.capabilities[ia.settings.videoCodec];e&&(o.options.profile=e.maxProfile,o.options.level=e.maxLevel)}let a=new tO(new tr({...ia.settings,logLevel:tt.Debug,scid:e7.random(),sendDeviceMeta:!1,sendDummyByte:!1,videoCodecOptions:o}));(0,ts.z)(()=>{this.log=[],this.log.push("[client] Server version: ".concat(tz)),this.log.push("[client] Server arguments: ".concat(a.serialize().join(" ")))});let s=await tk.start(tj.GLOBAL_STATE.adb,eF,tz,a);s.stdout.pipeTo(new ex.WritableStream({write:(0,ts.aD)(e=>{this.log.push(e)})}));let l=await tj.GLOBAL_STATE.adb.sync();try{await l.write({filename:is,file:new ex.ReadableStream({start(e){e.enqueue(new ex.Consumable((0,tx.encodeUtf8)(JSON.stringify({settings:ia.settings,clientSettings:ia.clientSettings})))),e.close()}})})}finally{l.dispose()}tS.recorder=new tw,s.videoStream.then(e=>{let{stream:t,metadata:i}=e;(0,ts.z)(()=>{tS.recorder.videoMetadata=i});let r=new n.Constructor(i.codec);(0,ts.z)(()=>{this.decoder=r;let e=0,t=0;this.fpsCounterIntervalId=setInterval((0,ts.aD)(()=>{let i=r.frameRendered-e,n=r.frameSkipped-t;this.fps="".concat(i).concat(n?"+".concat(n," skipped"):""),e=r.frameRendered,t=r.frameSkipped}),1e3)});let o=0n,a=new ex.InspectStream(e=>{if(tS.recorder.addVideoPacket(e),"configuration"===e.type){let t,r;switch(i.codec){case G.H264:({croppedWidth:t,croppedHeight:r}=ea(e.data));break;case G.H265:({croppedWidth:t,croppedHeight:r}=ep(e.data));break;default:throw Error("Codec not supported")}(0,ts.z)(()=>{this.log.push("[client] Video size changed: ".concat(t,"x").concat(r)),this.width=t,this.height=r})}else if(e.keyframe&&void 0!==e.pts){if(o){let t=Number(e.pts-o)/1e3|0;(0,ts.z)(()=>{this.log.push("[client] Keyframe interval: ".concat(t,"ms"))})}o=e.pts}});t.pipeThrough(a).pipeTo(r.writable)}),null===(e=s.audioStream)||void 0===e||e.then(async e=>{switch(e.type){case"disabled":(0,ts.z)(()=>this.log.push("[client] Demuxer audio: stream explicitly disabled by the device"));return;case"errored":(0,ts.z)(()=>this.log.push("[client] Demuxer audio: stream configuration error on the device"));return;case"success":break;default:throw Error("Unexpected audio metadata type ".concat(e.type))}let[t,i]=e.stream.tee();switch(e.codec){case eR.RAW:{let e=new tU(48e3);this.audioPlayer=e,i.pipeTo(new ex.WritableStream({write:t=>{e.feed(new Int16Array(t.data.buffer,t.data.byteOffset,t.data.byteLength/Int16Array.BYTES_PER_ELEMENT))}})),await this.audioPlayer.start();break}case eR.OPUS:{let t=new tI(48e3);this.audioPlayer=t,i.pipeThrough(new tG({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new ex.WritableStream({write:e=>{t.feed(e)}})),await t.start();break}case eR.AAC:{let t=new tH(48e3);this.audioPlayer=t,i.pipeThrough(new tB({codec:e.codec.webCodecId,numberOfChannels:2,sampleRate:48e3})).pipeTo(new ex.WritableStream({write:e=>{t.feed(e)}})),await t.start();break}default:throw Error("Unsupported audio codec ".concat(e.codec.optionValue))}(0,ts.z)(()=>{tS.recorder.audioCodec=e.codec}),t.pipeTo(new ex.WritableStream({write:e=>{"data"===e.type&&tS.recorder.addAudioPacket(e)}}))}),s.exit.then(this.dispose),s.deviceMessageStream.pipeTo(new ex.WritableStream({write(e){e.type===H.Clipboard&&globalThis.navigator.clipboard.writeText(e.content)}})),ia.clientSettings.turnScreenOff&&await s.controlMessageWriter.setScreenPowerMode(I.Off),(0,ts.z)(()=>{this.client=s,this.hoverHelper=new ey,this.running=!0});let d=tj.GLOBAL_STATE.device;d instanceof tL.Of?this.keyboard=await tq.register(d.raw):this.keyboard=new tY(s)}catch(e){tj.GLOBAL_STATE.showErrorDialog(e)}finally{(0,ts.z)(()=>{this.connecting=!1})}},(0,ts.ky)(this,{start:!1,stop:ts.aD.bound,dispose:ts.aD.bound,setFullScreenContainer:ts.aD.bound,setRendererContainer:ts.aD.bound,clientPositionToDevicePosition:!1}),(0,ts.EH)(()=>{tj.GLOBAL_STATE.adb||this.dispose()}),"object"==typeof document&&document.addEventListener("fullscreenchange",()=>{document.fullscreenElement||(0,ts.z)(()=>{this.isFullScreen=!1})}),(0,ts.EH)(()=>{if(this.rendererContainer&&this.decoder){for(;this.rendererContainer.firstChild;)this.rendererContainer.firstChild.remove();this.rendererContainer.appendChild(this.decoder.renderer)}})}},ic=(0,ts.Fl)(()=>{let e=[];return e.push({key:"stop",iconProps:{iconName:tf.PJ.Stop},text:"Stop",onClick:id.stop}),e.push(tS.recording?{key:"Record",iconProps:{iconName:tf.PJ.Record,style:{color:"red"}},text:"".concat(tS.hours?"".concat(tS.hours,":"):"").concat(tS.minutes.toString().padStart(2,"0"),":").concat(tS.seconds.toString().padStart(2,"0")),onClick:(0,ts.aD)(()=>{id.fullScreenContainer.focus(),tS.recorder.stop(),tS.recording=!1})}:{key:"Record",disabled:!id.running,iconProps:{iconName:tf.PJ.Record},text:"Record",onClick:(0,ts.aD)(()=>{id.fullScreenContainer.focus(),tS.recorder.start(),tS.recording=!0})}),e.push({key:"fullscreen",disabled:!id.running,iconProps:{iconName:tf.PJ.FullScreenMaximize},iconOnly:!0,text:"Fullscreen",onClick:(0,ts.aD)(()=>{id.fullScreenContainer.focus(),id.fullScreenContainer.requestFullscreen(),id.isFullScreen=!0})}),e.push({key:"volumeUp",disabled:!id.running,iconProps:{iconName:tf.PJ.Speaker2},iconOnly:!0,text:"Volume Up",onClick:async()=>{var e,t;id.fullScreenContainer.focus(),await (null===(e=id.client)||void 0===e?void 0:e.controlMessageWriter).injectKeyCode({action:R.Down,keyCode:U.VolumeUp,repeat:0,metaState:0}),await (null===(t=id.client)||void 0===t?void 0:t.controlMessageWriter).injectKeyCode({action:R.Up,keyCode:U.VolumeUp,repeat:0,metaState:0})}},{key:"volumeDown",disabled:!id.running,iconProps:{iconName:tf.PJ.Speaker1},iconOnly:!0,text:"Volume Down",onClick:async()=>{var e,t;id.fullScreenContainer.focus(),await (null===(e=id.client)||void 0===e?void 0:e.controlMessageWriter).injectKeyCode({action:R.Down,keyCode:U.VolumeDown,repeat:0,metaState:0}),await (null===(t=id.client)||void 0===t?void 0:t.controlMessageWriter).injectKeyCode({action:R.Up,keyCode:U.VolumeDown,repeat:0,metaState:0})}},{key:"volumeMute",disabled:!id.running,iconProps:{iconName:tf.PJ.SpeakerOff},iconOnly:!0,text:"Toggle Mute",onClick:async()=>{var e,t;id.fullScreenContainer.focus(),await (null===(e=id.client)||void 0===e?void 0:e.controlMessageWriter).injectKeyCode({action:R.Down,keyCode:U.VolumeMute,repeat:0,metaState:0}),await (null===(t=id.client)||void 0===t?void 0:t.controlMessageWriter).injectKeyCode({action:R.Up,keyCode:U.VolumeMute,repeat:0,metaState:0})}}),e.push({key:"rotateDevice",disabled:!id.running,iconProps:{iconName:tf.PJ.Orientation},iconOnly:!0,text:"Rotate Device",onClick:()=>{id.fullScreenContainer.focus(),id.client.controlMessageWriter.rotateDevice()}},{key:"rotateVideoLeft",disabled:!id.running,iconProps:{iconName:tf.PJ.RotateLeft},iconOnly:!0,text:"Rotate Video Left",onClick:(0,ts.aD)(()=>{id.fullScreenContainer.focus(),id.rotation-=1,id.rotation<0&&(id.rotation=3)})},{key:"rotateVideoRight",disabled:!id.running,iconProps:{iconName:tf.PJ.RotateRight},iconOnly:!0,text:"Rotate Video Right",onClick:(0,ts.aD)(()=>{id.fullScreenContainer.focus(),id.rotation=id.rotation+1&3})}),e.push({key:"turnScreenOff",disabled:!id.running,iconProps:{iconName:tf.PJ.Lightbulb},iconOnly:!0,text:"Turn Screen Off",onClick:()=>{id.fullScreenContainer.focus(),id.client.controlMessageWriter.setScreenPowerMode(I.Off)}},{key:"turnScreenOn",disabled:!id.running,iconProps:{iconName:tf.PJ.LightbulbFilament},iconOnly:!0,text:"Turn Screen On",onClick:()=>{id.fullScreenContainer.focus(),id.client.controlMessageWriter.setScreenPowerMode(I.Normal)}}),id.running&&e.push({key:"fps",text:"FPS: ".concat(id.fps),disabled:!0}),e.push({key:"spacer",onRender:()=>(0,W.jsx)(tg.X,{})},{key:"separator",disabled:!0,itemType:tp.n.Divider}),e.push({key:"NavigationBar",iconProps:{iconName:tf.PJ.PanelBottom},canCheck:!0,checked:id.navigationBarVisible,text:"Navigation Bar",iconOnly:!0,onClick:(0,ts.aD)(()=>{id.navigationBarVisible=!id.navigationBarVisible})},{key:"Log",iconProps:{iconName:tf.PJ.TextGrammarError},canCheck:!0,checked:id.logVisible,text:"Log",iconOnly:!0,onClick:(0,ts.aD)(()=>{id.logVisible=!id.logVisible})},{key:"DemoMode",iconProps:{iconName:tf.PJ.Wand},canCheck:!0,checked:id.demoModeVisible,text:"Demo Mode",iconOnly:!0,onClick:(0,ts.aD)(()=>{id.demoModeVisible=!id.demoModeVisible})}),e}),iu=(0,tl.Pi)(function(){return(0,W.jsx)(tm.X,{items:ic.get()})});var ih=i(6035);let ip=(0,et.Z)({container:{height:"40px",backgroundColor:"#999"},bar:{width:"100%",maxWidth:"300px"},icon:{color:"white"},back:{transform:"rotate(180deg)"}});function im(e){return!!id.client&&0===e.button&&(id.fullScreenContainer.focus(),e.currentTarget.setPointerCapture(e.pointerId),e.preventDefault(),e.stopPropagation(),!0)}function ig(e){return!!id.client&&0===e.button}function iy(e){im(e)&&id.client.controlMessageWriter.backOrScreenOn(R.Down)}function iv(e){ig(e)&&id.client.controlMessageWriter.backOrScreenOn(R.Up)}function ib(e){im(e)&&id.client.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:U.AndroidHome,repeat:0,metaState:0})}function iw(e){ig(e)&&id.client.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:U.AndroidHome,repeat:0,metaState:0})}function iS(e){im(e)&&id.client.controlMessageWriter.injectKeyCode({action:R.Down,keyCode:U.AndroidAppSwitch,repeat:0,metaState:0})}function ix(e){ig(e)&&id.client.controlMessageWriter.injectKeyCode({action:R.Up,keyCode:U.AndroidAppSwitch,repeat:0,metaState:0})}let iL=(0,tl.Pi)(function(e){let{className:t,style:i,children:r}=e,n=ip();return id.navigationBarVisible?(0,W.jsxs)(q.K,{className:(0,ih.z)(n.container,t),verticalFill:!0,horizontalAlign:"center",style:i,children:[r,(0,W.jsxs)(q.K,{className:n.bar,verticalFill:!0,horizontal:!0,horizontalAlign:"space-evenly",verticalAlign:"center",children:[(0,W.jsx)(t6.h,{className:(0,ih.z)(n.back,n.icon),iconProps:{iconName:tf.PJ.Play},onPointerDown:iy,onPointerUp:iv}),(0,W.jsx)(t6.h,{className:n.icon,iconProps:{iconName:tf.PJ.Circle},onPointerDown:ib,onPointerUp:iw}),(0,W.jsx)(t6.h,{className:n.icon,iconProps:{iconName:tf.PJ.Stop},onPointerDown:iS,onPointerUp:ix})]})]}):(0,W.jsx)("div",{className:t,style:i,children:r})}),iE=(0,et.Z)({video:{transformOrigin:"center center",touchAction:"none"}});function ik(e){if(!id.client)return;id.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation();let{x:t,y:i}=id.clientPositionToDevicePosition(e.clientX,e.clientY);id.client.controlMessageWriter.injectScroll({screenWidth:id.client.screenWidth,screenHeight:id.client.screenHeight,pointerX:t,pointerY:i,scrollX:-e.deltaX/100,scrollY:-e.deltaY/100,buttons:0})}let iC=[_.Primary,_.Tertiary,_.Secondary,_.Back,_.Forward];function iT(e,t){let i;if(!id.client)return;let{pointerType:r}=t;i="mouse"===r?O.Finger:BigInt(t.pointerId);let{x:n,y:o}=id.clientPositionToDevicePosition(t.clientX,t.clientY),a=id.hoverHelper.process({action:e,pointerId:i,screenWidth:id.client.screenWidth,screenHeight:id.client.screenHeight,pointerX:n,pointerY:o,pressure:t.pressure,actionButton:iC[t.button],buttons:t.buttons});for(let e of a)id.client.controlMessageWriter.injectTouch(e)}function iA(e){id.client&&(id.fullScreenContainer.focus(),e.preventDefault(),e.stopPropagation(),e.currentTarget.setPointerCapture(e.pointerId),iT(M.Down,e))}function iP(e){id.client&&(e.preventDefault(),e.stopPropagation(),iT(0===e.buttons?M.HoverMove:M.Move,e))}function iD(e){id.client&&(e.preventDefault(),e.stopPropagation(),iT(M.Up,e))}function iN(e){id.client&&(e.preventDefault(),e.stopPropagation(),iT(M.HoverExit,e),iT(M.Up,e))}function iM(e){e.preventDefault()}function i_(){let e=iE(),[t,i]=(0,tu.useState)(null);return(0,tu.useEffect)(()=>{if(id.setRendererContainer(t),t)return t.addEventListener("wheel",ik,{passive:!1}),()=>{t.removeEventListener("wheel",ik)}},[t]),(0,W.jsx)("div",{ref:i,className:e.video,style:{width:id.width,height:id.height,transform:"translate(".concat((id.rotatedWidth-id.width)/2,"px, ").concat((id.rotatedHeight-id.height)/2,"px) rotate(").concat(90*id.rotation,"deg)")},onPointerDown:iA,onPointerMove:iP,onPointerUp:iD,onPointerCancel:iD,onPointerLeave:iN,onContextMenu:iM})}let iO=(e,t,i,r,n)=>{(0,tu.useEffect)(()=>{let n="function"==typeof e?e():e;return n.addEventListener(t,i,r),()=>n.removeEventListener(t,i,r)},n)},iz=tu.useLayoutEffect;Symbol("UNINITIALIZED");let iR="undefined"!=typeof localStorage?function(e,t){var i;let[r,n]=(0,tu.useState)(()=>localStorage.getItem(e)||t);iO(globalThis,"storage",()=>n(null!==(i=localStorage.getItem(e))&&void 0!==i?i:t),{passive:!0},[e,t]);let o=function(e){let t=function(e){let t=(0,tu.useRef)(e);return iz(()=>{t.current=e},[e]),t}(e);return function(e){let t=(0,tu.useRef)(e);return t.current}(function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.current(...i)})}(t=>{n(t),localStorage.setItem(e,t)});return[r,o]}:(e,t)=>[t,()=>{}],iF=(0,et.Z)({layerHost:{position:"absolute",top:0,bottom:0,left:0,right:0,pointerEvents:"none",...ei.q5.margin(0)},fullScreenContainer:{flexGrow:1,display:"flex",flexDirection:"column",backgroundColor:"black",":focus-visible":{...ei.q5.outline("0")}},fullScreenStatusBar:{display:"flex",color:"white",columnGap:"12px",...ei.q5.padding("8px","20px")},spacer:{flexGrow:1}}),iU=(0,tl.Pi)(()=>{let e=iF(),t=(0,ee.M)("layerHost"),[i,r]=(0,tu.useState)(!1);return((0,tu.useEffect)(()=>{r(!0)},[]),i)?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Z.Z,{id:t,className:e.layerHost}),(0,W.jsx)(Y.V,{hidden:!id.connecting,modalProps:{layerProps:{hostId:t}},dialogContentProps:{title:"Connecting..."},children:(0,W.jsxs)(q.K,{tokens:tf.WT,children:[(0,W.jsx)(X.Y,{label:"Downloading scrcpy server...",percentComplete:id.serverTotalSize?id.serverDownloadedSize/id.serverTotalSize:void 0,description:(0,tf.CY)(id.debouncedServerDownloadedSize,id.serverTotalSize,id.serverDownloadSpeed)}),(0,W.jsx)(X.Y,{label:"Pushing scrcpy server to device...",progressHidden:0===id.serverTotalSize||id.serverDownloadedSize!==id.serverTotalSize,percentComplete:id.serverUploadedSize/id.serverTotalSize,description:(0,tf.CY)(id.debouncedServerUploadedSize,id.serverTotalSize,id.serverUploadSpeed)}),(0,W.jsx)(X.Y,{label:"Starting scrcpy server on device...",progressHidden:0===id.serverTotalSize||id.serverUploadedSize!==id.serverTotalSize})]})})]}):null});async function iI(e){if(!id.client)return;e.preventDefault(),e.stopPropagation();let{type:t,code:i}=e;id.keyboard["keydown"===t?"down":"up"](i)}function iH(){var e;id.client&&(null===(e=id.keyboard)||void 0===e||e.reset())}let ij=(0,tl.Pi)(function(e){var t;let{keyboardLockEnabled:i}=e,r=iF(),[n,o]=iR("scrcpy-hint-hidden","false");return i&&id.isFullScreen&&"true"!==n?(0,W.jsxs)("div",{className:r.fullScreenStatusBar,children:[(0,W.jsx)("div",{children:null===(t=tj.GLOBAL_STATE.device)||void 0===t?void 0:t.serial}),(0,W.jsxs)("div",{children:["FPS: ",id.fps]}),(0,W.jsx)("div",{className:r.spacer}),(0,W.jsx)("div",{children:"Press and hold ESC to exit full screen"}),(0,W.jsx)(J.r,{onClick:()=>o("true"),children:"Don't show again"})]}):null});var iB=(0,tl.Pi)(()=>{let e=iF();(0,tu.useEffect)(()=>{1===ia.decoders.length&&ta.isSupported()&&(0,ts.z)(()=>{ia.decoders.unshift({key:"webcodecs",name:"WebCodecs",Constructor:ta})})},[]);let[t,i]=(0,tu.useState)(!1);return(0,tu.useEffect)(()=>{if("keyboard"in navigator)return navigator.keyboard.lock(),i(!0),()=>{navigator.keyboard.unlock()}},[]),(0,tu.useEffect)(()=>(window.addEventListener("blur",iH),()=>{window.removeEventListener("blur",iH)}),[]),(0,W.jsxs)(q.K,{...tf.LE,children:[(0,W.jsx)(tc(),{children:(0,W.jsx)("title",{children:"Scrcpy - Tango"})}),id.running?(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(iu,{}),(0,W.jsxs)(q.K,{horizontal:!0,grow:!0,styles:{root:{height:0}},children:[(0,W.jsxs)("div",{ref:id.setFullScreenContainer,className:e.fullScreenContainer,tabIndex:0,onKeyDown:iI,onKeyUp:iI,children:[(0,W.jsx)(ij,{keyboardLockEnabled:t}),(0,W.jsx)(th.wM,{width:id.rotatedWidth,height:id.rotatedHeight,BottomElement:iL,children:(0,W.jsx)(i_,{})})]}),(0,W.jsx)("div",{style:{padding:12,overflow:"hidden auto",display:id.logVisible?"block":"none",width:500,fontFamily:"monospace",overflowY:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word"},children:id.log.map((e,t)=>(0,W.jsx)("div",{children:e},t))}),(0,W.jsx)(th.bq,{style:{display:id.demoModeVisible?"block":"none"}})]})]}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{children:[(0,W.jsx)(th.dL,{href:"https://github.com/Genymobile/scrcpy",spaceAfter:!0,children:"Scrcpy"}),"can mirror device display and audio with low latency and control the device, all without root access."]}),(0,W.jsx)("div",{children:"This is a TypeScript re-implementation of the client part. Paired with official pre-built server binary."}),(0,W.jsx)($.v,{align:"start",children:(0,W.jsx)(Q.K,{text:"Start",disabled:!tj.GLOBAL_STATE.adb,onClick:id.start})}),il.get().map(e=>(0,W.jsx)(ir,{definition:e,value:ia[e.group][e.key],onChange:(0,ts.aD)((e,t)=>ia[e.group][e.key]=t)},e.key)),(0,W.jsx)(iU,{})]})]})})},2097:function(e,t,i){"use strict";e.exports=i.p+"static/media/worker.f22e6881.js"},2821:function(e,t,i){"use strict";e.exports=i.p+"static/media/server.e05cfb58.bin"}},function(e){e.O(0,[384,775,908,774,888,179],function(){return e(e.s=8014)}),_N_E=e.O()}]);
//# sourceMappingURL=scrcpy-4d4af2bfd637370c.js.map